"use strict";(self.webpackChunkmuzieklijsten=self.webpackChunkmuzieklijsten||[]).push([[546],{926:function(e,t,r){r.d(t,{Df:function(){return o},Jc:function(){return a},am:function(){return i},em:function(){return s}});var n=r(936);async function s(e,t,r){t(await n.b("vul_datatables",e))}function i(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children}function a(e){const t=[/^(\+31)((?:11|16|17|18|22|25|29|31|32|34|41|44|47|47|48|49|51|52|54|56|57|59|67|80|90)[0-9])([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)(6)([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)([0-9]{2})([0-9]{3})([0-9]{2})([0-9]{2})$/];for(const r of t){let t=e.match(r);if(null!==t&&t.length>0)return t.shift(),t.join(" ")}return e}function o(e){let t="";for(;t.length<e;)t+=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(36);return t.substring(0,e)}},936:function(e,t,r){function n(e,t){return new Promise(((r,n)=>{const i=new XMLHttpRequest;let a;i.open("POST","ajax.php",!0),i.onload=s.bind(void 0,i,r,n),i.onerror=s.bind(void 0,i,r,n),t instanceof FormData?(t.append("functie",e),a=t):(a=JSON.stringify({functie:e,...t}),i.setRequestHeader("Content-Type","application/json")),i.send(a)}))}function s(e,t,r,n){try{const n=JSON.parse(e.response);!1!==n.error?r(new Error(n.errordata)):t(n.data)}catch(t){r(new Error(e.responseText))}}r.d(t,{b:function(){return n}})},172:function(e,t,r){r(125);var n=r(601),s=r(936),i=r(926);class a{e_tr;constructor(e,t,r){this.e_tr=document.createElement("tr");const n=document.createElement("td");n.appendChild(document.createTextNode(t)),this.e_tr.appendChild(n);const s=document.createElement("td");s.appendChild(document.createTextNode(r)),this.e_tr.appendChild(s);const i=document.createElement("td");i.classList.add("remark"),this.e_tr.appendChild(i);const a=document.createElement("input");a.type="text",a.classList.add("form-control"),a.maxLength=1024,a.name=`nummers[${e}][toelichting]`,i.appendChild(a);const o=document.createElement("input");o.type="hidden",o.name=`nummers[${e}][id]`,o.value=e,this.e_tr.appendChild(o),document.querySelector("#keuzes tbody").appendChild(this.e_tr)}destroy(){this.e_tr.remove()}}class o{e_form_group;constructor(e){let{id:t,label:r,leeg_feedback:n,max:s,maxlength:i,min:a,minlength:o,placeholder:d,type:l,verplicht:m}=e;const c=`veld-${t}`,u=`velden[${t}]`;this.e_form_group=document.createElement("div"),this.e_form_group.classList.add("form-group","row");const h=document.createElement("label");this.e_form_group.appendChild(h),h.classList.add("control-label","col-sm-2"),h.setAttribute("for",c),h.appendChild(document.createTextNode(r));const _=document.createElement("div");let g;this.e_form_group.appendChild(_),_.classList.add("col-sm-10"),"textarea"===l?(g=document.createElement("textarea"),g.rows=5):(g=document.createElement("input"),"postcode"===l?(g.type="text",g.classList.add("postcode")):g.type=l,Number.isInteger(s)&&(g.max=s),Number.isInteger(a)&&(g.min=a)),_.appendChild(g),g.classList.add("form-control"),g.id=c,g.name=u,g.setAttribute("data-leeg-feedback",n),Number.isInteger(i)&&(g.maxLength=i),Number.isInteger(o)&&(g.minLength=o),"string"==typeof d&&(g.placeholder=d),g.required=m,document.getElementById("formulier-velden").appendChild(this.e_form_group)}}class d{lijst_id;minkeuzes;maxkeuzes;is_artiest_eenmalig;heeft_recaptcha;geselecteerde_nummers;geselecteerde_artiesten;e_datatable;e_datatable_body;datatable;e_body;e_keuzeformulier;e_stemmerformulier;serverdata_promise;e_errormsg;random_seed;constructor(){this.lijst_id=new URLSearchParams(window.location.search).get("lijst"),this.e_body=document.getElementsByTagName("body").item(0),this.e_keuzeformulier=document.getElementById("keuzeformulier"),this.e_stemmerformulier=document.getElementById("stemmerformulier"),this.geselecteerde_nummers={},this.geselecteerde_artiesten=[],this.e_errormsg=document.getElementById("errormsg"),this.random_seed=Math.floor(65536*Math.random()),this.init()}async init(){await this.vul_serverdata(),this.e_body.classList.add("geladen");const e=document.getElementById("nummers");this.datatable=new n.A(e,{processing:!0,serverSide:!0,ajax:(e,t,r)=>{e.lijst=this.lijst_id,e.is_vrijekeuze=!1,e.random_seed=this.random_seed,i.em(e,t,r)},bLengthChange:!1,iDisplayLength:50,columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:(e,t,r,n)=>'<input type="checkbox">'}],order:[[2,"asc"],[1,"asc"]],ordering:!await this.is_random_volgorde(),language:{lengthMenu:"_MENU_ nummers per pagina",zeroRecords:"Geen nummers gevonden",info:"Pagina _PAGE_ van _PAGES_",infoEmpty:"Geen nummers gevonden",infoFiltered:"(gefilterd van _MAX_ totaal)",search:"Zoeken:",paginate:{first:"Eerste",last:"Laatste",next:"Volgende",previous:"Vorige"}}}),this.e_datatable_body=e.getElementsByTagName("tbody").item(0);for(const e of this.e_stemmerformulier.elements)this.add_trim_handler(e);this.e_datatable_body.addEventListener("click",this.tabel_klik_handler.bind(this)),this.e_keuzeformulier.addEventListener("submit",this.submit_handler.bind(this)),this.e_stemmerformulier.addEventListener("submit",this.submit_handler.bind(this))}async vul_serverdata(){let e;try{e=await this.get_serverdata()}catch(e){return void this.error(e)}this.minkeuzes=e.minkeuzes,this.maxkeuzes=e.maxkeuzes,this.is_artiest_eenmalig=e.is_artiest_eenmalig;const t=`${e.organisatie} – ${e.lijst_naam}`;document.getElementsByTagName("title").item(0).innerText=t,e.heeft_gebruik_recaptcha&&this.e_body.classList.add("heeft-recaptcha"),e.is_actief&&this.e_body.classList.add("is-actief"),this.e_keuzeformulier.elements.lijst.value=this.lijst_id;for(const t of e.velden)new o(t);for(let t=0;t<e.vrijekeuzes;t++)this.vrijkeuze_toevoegen(t,e.vrijekeuzes);for(const t of document.querySelectorAll(".g-recaptcha")){t.setAttribute("data-sitekey",e.recaptcha_sitekey);const r=document.createElement("script");r.src="https://www.google.com/recaptcha/api.js?hl=nl",t.parentElement.appendChild(r)}for(const t of document.querySelectorAll(".organisatie"))t.innerText=e.organisatie;for(const t of document.querySelectorAll("a.privacy-url"))t.setAttribute("href",e.privacy_url)}get_serverdata(){return this.serverdata_promise??=s.b("get_stemlijst_frontend_data",{lijst:this.lijst_id})}async is_random_volgorde(){return(await this.get_serverdata()).random_volgorde}async submit_handler(e){if(e.preventDefault(),e.stopPropagation(),Object.keys(this.geselecteerde_nummers).length<this.minkeuzes)return void alert(`U moet mimimaal ${this.minkeuzes} nummers selecteren.`);if(this.heeft_recaptcha&&""===document.getElementById("g-recaptcha-response").value)return void alert("Plaats een vinkje a.u.b.");for(const e of this.e_stemmerformulier.elements){if(e.required&&""===e.value)return alert(e.getAttribute("data-leeg-feedback")),void e.focus();if(e.min>0&&e.valueAsNumber<e.min)return void alert(`De waarde van ${e.name} is te laag. Het minimum is ${e.min}`);if(e.max>0&&e.valueAsNumber>e.max)return void alert(`De waarde van ${e.name} is te hoog. Het maximum is ${e.max}`);if(e.minLength>0&&e.value.length<e.minLength)return void alert(`De invoer van ${e.name} is te kort. De minimumlengte is ${e.minLenght}`);if(e.maxLength>0&&e.value.length>e.maxLength)return void alert(`De invoer van ${e.name} is te lang. De maximumlengte is ${e.maxLength}`)}const t=new FormData(this.e_stemmerformulier);t.append("lijst",this.lijst_id);try{const e=await s.b("stem",t),r=document.getElementById("stemsegment").offsetHeight-100;document.getElementById("stemsegment-placeholder").style.height=`${r}px`,document.getElementById("result").innerHTML=e,this.e_body.classList.add("gestemd")}catch(e){alert(e)}}add_trim_handler(e){(e instanceof HTMLInputElement&&["email","month","number","tel","text","time","url","week"].includes(e.type)||e instanceof HTMLTextAreaElement)&&e.addEventListener("blur",(e=>{e.target.value=e.target.value.trim()}))}tabel_klik_handler(e){const t=e.target.closest("tr"),r=t.querySelector('input[type="checkbox"]'),n=e.target instanceof HTMLInputElement,s=n&&r.checked||!n&&!r.checked;let[i,o,d]=this.datatable.row(t).data();if(i=Number.parseInt(i),s){if(Object.keys(this.geselecteerde_nummers).length>=this.maxkeuzes)return r.checked=!1,void alert(`U kunt maximaal ${this.maxkeuzes} nummers selecteren.`);if(this.is_artiest_eenmalig&&this.geselecteerde_artiesten.includes(d))return r.checked=!1,void alert("Deze artiest is al gekozen");this.geselecteerde_nummers[i]=new a(i,o,d),this.geselecteerde_artiesten.includes(d)||this.geselecteerde_artiesten.push(d),r.checked=!0,t.classList.add("selected")}else{this.geselecteerde_nummers[i].destroy(),delete this.geselecteerde_nummers[i];const e=this.geselecteerde_artiesten.indexOf(d);-1!==e&&this.geselecteerde_artiesten.splice(e,1),r.checked=!1,t.classList.remove("selected")}Object.keys(this.geselecteerde_nummers).length>0?this.e_body.classList.add("heeft-nummers-geselecteerd"):this.e_body.classList.remove("heeft-nummers-geselecteerd")}vrijkeuze_toevoegen(e,t){const r=1===t?"Vrije keuze":`Vrije keuze ${e+1}`,n=this.vrijkeuze_toevoegen_veld("Artiest",e,3,128),s=this.vrijkeuze_toevoegen_veld("Titel",e,3,128),i=this.vrijkeuze_toevoegen_veld("Toelichting",e,4,512),a=document.createElement("div");a.classList.add("form-group","row");const o=document.createElement("label");a.appendChild(o),o.classList.add("control-label","col-sm-2"),o.setAttribute("for",n.querySelector("input").id),o.appendChild(document.createTextNode(r)),a.appendChild(n),a.appendChild(s),a.appendChild(i),document.getElementById("formulier-velden").appendChild(a)}vrijkeuze_toevoegen_veld(e,t,r,n){const s=e.toLowerCase(),i=`vrijekeuze-${s}-${t}`,a=`vrijekeuzes[${t}][${s}]`,o=document.createElement("div");o.classList.add(`col-sm-${r}`);const d=document.createElement("input");return d.type="text",o.appendChild(d),d.classList.add("form-control"),d.id=i,d.name=a,d.maxLength=n,d.placeholder=e,o}error(e){this.e_errormsg.innerText=e,this.e_body.classList.add("error")}}document.addEventListener("DOMContentLoaded",(()=>{new d}))}},function(e){e.O(0,[778,408],(function(){return t=172,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxjQUNuQjFJLEVBQVMsY0FBY3lJLEtBQWVSLElBQ3RDaEksRUFBTyxlQUFlZ0ksTUFBV1EsS0FFakNySSxFQUFRM0YsU0FBU0MsY0FBYyxPQUNyQzBGLEVBQU0zQixVQUFVQyxJQUFJLFVBQVU2SixLQUU5QixNQUFNbEksRUFBVTVGLFNBQVNDLGNBQWMsU0FRdkMsT0FQQTJGLEVBQVF6QixLQUFPLE9BQ2Z3QixFQUFNL0IsWUFBWWdDLEdBQ2xCQSxFQUFRNUIsVUFBVUMsSUFBSSxnQkFDdEIyQixFQUFRZCxHQUFLUyxFQUNiSyxFQUFRdkIsS0FBT21CLEVBQ2ZJLEVBQVF4QixVQUFZMkosRUFDcEJuSSxFQUFRUCxZQUFjd0csRUFDZmxHLENBQ1QsQ0FNQTNDLEtBQUFBLENBQU1tSCxHQUNKekcsS0FBS3VELFdBQVdxRCxVQUFZSCxFQUM1QnpHLEtBQUttRCxPQUFPN0MsVUFBVUMsSUFBSSxRQUM1QixFQUdGakUsU0FBUzhKLGlCQUFpQixvQkFBb0IsS0FDNUMsSUFBSTVELENBQVUsRyIsInNvdXJjZXMiOlsid2VicGFjazovL211emlla2xpanN0ZW4vLi9zcmMvanMvbGliL2Z1bmN0aWVzLnRzIiwid2VicGFjazovL211emlla2xpanN0ZW4vLi9zcmMvanMvbGliL3NlcnZlci50cyIsIndlYnBhY2s6Ly9tdXppZWtsaWpzdGVuLy4vc3JjL2pzL211emlla2xpanN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHNlcnZlciBmcm9tICdAbXV6aWVrbGlqc3Rlbi9zZXJ2ZXInO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdnVsX2RhdGF0YWJsZXMoXG4gIGRhdGE6IHtba2V5OiBzdHJpbmddOiBhbnl9LFxuICBjYWxsYmFjazogKGE6IHNlcnZlci5BamF4TWFwWyd2dWxfZGF0YXRhYmxlcyddWydyZXNwb25zZSddKSA9PiB2b2lkLFxuICBzZXR0aW5nczoge1trZXk6IHN0cmluZ106IGFueX1cbikge1xuICBjb25zdCByZXNwb25zID0gYXdhaXQgc2VydmVyLnBvc3QoJ3Z1bF9kYXRhdGFibGVzJywgZGF0YSk7XG4gIGNhbGxiYWNrKHJlc3BvbnMpO1xufVxuXG4vKipcbiAqIE1hYWt0IERPTS1lbGVtZW50ZW4gdmFuIGVlbiBkb29yIGh0bWwtbG9hZGVyIGdlw69tcG9ydGVlcmQgdGVtcGxhdGUuXG4gKiBAcmV0dXJucyBEZSByb290LWVsZW1lbnRlbiB2YW4gaGV0IHRlbXBsYXRlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0X2h0bWxfdGVtcGxhdGUoZ2VpbXBvcnRlZXJkX3RlbXBsYXRlOiBzdHJpbmcpOiBIVE1MQ29sbGVjdGlvbiB7XG4gIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTtcbiAgdGVtcGxhdGUuaW5uZXJIVE1MID0gZ2VpbXBvcnRlZXJkX3RlbXBsYXRlLnRyaW0oKTtcbiAgcmV0dXJuIHRlbXBsYXRlLmNvbnRlbnQuY2hpbGRyZW47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRfaHRtbF90ZW1wbGF0ZV9lbmtlbDxUIGV4dGVuZHMgRWxlbWVudD4oZ2VpbXBvcnRlZXJkX3RlbXBsYXRlOiBzdHJpbmcpOiBUIHtcbiAgY29uc3QgdGVtcGxhdGUgPSBnZXRfaHRtbF90ZW1wbGF0ZShnZWltcG9ydGVlcmRfdGVtcGxhdGUpO1xuICBpZiAoIHRlbXBsYXRlLmxlbmd0aCAhPT0gMSApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGVtcGxhdGUtaHRtbCBtb2V0IGV4YWN0IMOpw6luIHJvb3QtZWxlbWVudCBoZWJiZW4uJyk7XG4gIH1cbiAgcmV0dXJuIHRlbXBsYXRlLml0ZW0oMCkgYXMgVDtcbn1cblxuLyoqXG4gKiBQbGFhdHN0IChub24gYnJlYWtpbmcpIHNwYXRpZXMgaW4gZWVuIE5lZGVybGFuZHMgaW50ZXJuYXRpb25hYWwgdGVsZWZvb25udW1tZXJcbiAqIHZvb3IgZGUgbGVlc2JhYXJoZWlkLlxuICogQHBhcmFtIHRlbGVmb29ubnVtbWVyIC0gT3JpZ2luZWVsIHRlbGVmb29ubnVtbWVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRfdGVsZWZvb25udW1tZXIoIHRlbGVmb29ubnVtbWVyOiBzdHJpbmcgKTogc3RyaW5nIHtcbiAgY29uc3QgcGF0cm9uZW4gPSBbXG4gICAgICAvLyBWaWVyY2lqZmVyaWdlIG5ldG51bW1lcnNcbiAgICAgIC9eKFxcKzMxKSgoPzoxMXwxNnwxN3wxOHwyMnwyNXwyOXwzMXwzMnwzNHw0MXw0NHw0N3w0N3w0OHw0OXw1MXw1Mnw1NHw1Nnw1N3w1OXw2N3w4MHw5MClbMC05XSkoWzAtOV17Mn0pKFswLTldezJ9KShbMC05XXsyfSkkLyxcbiAgICAgIC8vIEVlbmNpamZlcmlnZSBuZXRudW1tZXJzXG4gICAgICAvXihcXCszMSkoNikoWzAtOV17Mn0pKFswLTldezJ9KShbMC05XXsyfSkoWzAtOV17Mn0pJC8sXG4gICAgICAvLyBUd2VlY2lqZmVyaWdlIG5ldG51bW1lcnNcbiAgICAgIC9eKFxcKzMxKShbMC05XXsyfSkoWzAtOV17M30pKFswLTldezJ9KShbMC05XXsyfSkkL1xuICBdO1xuICBmb3IgKCBjb25zdCBwYXRyb29uIG9mIHBhdHJvbmVuICkge1xuICAgICAgbGV0IG0gPSB0ZWxlZm9vbm51bW1lci5tYXRjaChwYXRyb29uKTtcbiAgICAgIGlmICggbSAhPT0gbnVsbCAmJiBtLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgbS5zaGlmdCgpO1xuICAgICAgICAgIHJldHVybiBtLmpvaW4oJ8KgJyk7XG4gICAgICB9XG4gIH1cbiAgcmV0dXJuIHRlbGVmb29ubnVtbWVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0X3JhbmRvbV9zdHJpbmcobGVuZ3RlOiBudW1iZXIpIHtcbiAgbGV0IHJlc3BvbnMgPSAnJztcbiAgd2hpbGUgKCByZXNwb25zLmxlbmd0aCA8IGxlbmd0ZSApIHtcbiAgICByZXNwb25zICs9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSpOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikudG9TdHJpbmcoMzYpO1xuICB9XG4gIHJldHVybiByZXNwb25zLnN1YnN0cmluZygwLCBsZW5ndGUpO1xufVxuIiwiZXhwb3J0IHR5cGUgQWpheE1hcCA9IHtcbiAgZ2V0X3N0ZW1saWpzdF9mcm9udGVuZF9kYXRhOiB7XG4gICAgcmVxdWVzdDoge1xuICAgICAgbGlqc3Q6IG51bWJlclxuICAgIH1cbiAgICByZXNwb25zZToge1xuICAgICAgbWlua2V1emVzOiBudW1iZXJcbiAgICAgIG1heGtldXplczogbnVtYmVyXG4gICAgICB2cmlqZWtldXplczogbnVtYmVyXG4gICAgICBpc19hcnRpZXN0X2Vlbm1hbGlnOiBib29sZWFuXG4gICAgICBvcmdhbmlzYXRpZTogc3RyaW5nXG4gICAgICBsaWpzdF9uYWFtOiBzdHJpbmdcbiAgICAgIGhlZWZ0X2dlYnJ1aWtfcmVjYXB0Y2hhOiBib29sZWFuXG4gICAgICBpc19hY3RpZWY6IGJvb2xlYW5cbiAgICAgIHZlbGRlbjoge1xuICAgICAgICBpZDogbnVtYmVyXG4gICAgICAgIGxhYmVsOiBzdHJpbmdcbiAgICAgICAgbGVlZ19mZWVkYmFjazogc3RyaW5nXG4gICAgICAgIHR5cGU6IHN0cmluZ1xuICAgICAgICB2ZXJwbGljaHQ6IGJvb2xlYW5cbiAgICAgICAgbWF4OiBudW1iZXJcbiAgICAgICAgbWF4bGVuZ3RoOiBudW1iZXJcbiAgICAgICAgbWluOiBudW1iZXJcbiAgICAgICAgbWlubGVuZ3RoOiBudW1iZXJcbiAgICAgICAgcGxhY2Vob2xkZXI6IHN0cmluZ1xuICAgICAgfVtdXG4gICAgICByZWNhcHRjaGFfc2l0ZWtleTogc3RyaW5nXG4gICAgICBwcml2YWN5X3VybDogc3RyaW5nXG4gICAgICByYW5kb21fdm9sZ29yZGU6IGJvb2xlYW5cbiAgICB9XG4gIH1cbiAgdmVyd2lqZGVyX2xpanN0OiB7XG4gICAgcmVxdWVzdDoge1xuICAgICAgbGlqc3Q6IG51bWJlclxuICAgIH1cbiAgICByZXNwb25zZTogdm9pZFxuICB9XG4gIGxpanN0X29wc2xhYW46IHtcbiAgICByZXF1ZXN0OiBGb3JtRGF0YVxuICAgIHJlc3BvbnNlOiB2b2lkXG4gIH1cbiAgbGlqc3RfbWFrZW46IHtcbiAgICByZXF1ZXN0OiBGb3JtRGF0YVxuICAgIHJlc3BvbnNlOiBudW1iZXJcbiAgfVxuICBsb3NzZV9udW1tZXJzX3RvZXZvZWdlbjoge1xuICAgIHJlcXVlc3Q6IHtcbiAgICAgIG51bW1lcnM6IHtcbiAgICAgICAgYXJ0aWVzdDogc3RyaW5nXG4gICAgICAgIHRpdGVsOiBzdHJpbmdcbiAgICAgIH1bXVxuICAgICAgbGlqc3RlbjogbnVtYmVyW11cbiAgICB9XG4gICAgcmVzcG9uc2U6IHtcbiAgICAgIHRvZWdldm9lZ2Q6IG51bWJlclxuICAgICAgZHViYmVsOiBudW1iZXJcbiAgICAgIGxpanN0ZW5fbnVtbWVyczogbnVtYmVyXG4gICAgfVxuICB9XG4gIGdldF9saWpzdGVuOiB7XG4gICAgcmVxdWVzdDoge31cbiAgICByZXNwb25zZToge1xuICAgICAgaWQ6IG51bWJlclxuICAgICAgbmFhbTogc3RyaW5nXG4gICAgfVtdXG4gIH1cbiAgc3RlbV9zZXRfYmVoYW5kZWxkOiB7XG4gICAgcmVxdWVzdDoge1xuICAgICAgbnVtbWVyOiBudW1iZXJcbiAgICAgIGxpanN0OiBudW1iZXJcbiAgICAgIHN0ZW1tZXI6IG51bWJlclxuICAgICAgd2FhcmRlOiBib29sZWFuXG4gICAgfVxuICAgIHJlc3BvbnNlOiB2b2lkXG4gIH1cbiAgdmVyd2lqZGVyX3N0ZW06IHtcbiAgICByZXF1ZXN0OiB7XG4gICAgICBudW1tZXI6IG51bWJlclxuICAgICAgbGlqc3Q6IG51bWJlclxuICAgICAgc3RlbW1lcjogbnVtYmVyXG4gICAgfVxuICAgIHJlc3BvbnNlOiB2b2lkXG4gIH1cbiAgdmVyd2lqZGVyX251bW1lcjoge1xuICAgIHJlcXVlc3Q6IHtcbiAgICAgIGxpanN0OiBudW1iZXJcbiAgICAgIG51bW1lcjogbnVtYmVyXG4gICAgfVxuICAgIHJlc3BvbnNlOiB2b2lkXG4gIH1cbiAgZ2V0X3RvdGFhbF9hYW50YWxfc3RlbW1lcnM6IHtcbiAgICByZXF1ZXN0OiB7XG4gICAgICBsaWpzdDogbnVtYmVyXG4gICAgICB2YW4/OiBzdHJpbmdcbiAgICAgIHRvdD86IHN0cmluZ1xuICAgIH1cbiAgICByZXNwb25zZTogbnVtYmVyXG4gIH1cbiAgc3RlbToge1xuICAgIHJlcXVlc3Q6IEZvcm1EYXRhXG4gICAgcmVzcG9uc2U6IHN0cmluZ1xuICB9XG4gIGxpanN0X251bW1lcl90b2V2b2VnZW46IHtcbiAgICByZXF1ZXN0OiB7XG4gICAgICBsaWpzdDogbnVtYmVyXG4gICAgICBudW1tZXI6IG51bWJlclxuICAgIH1cbiAgICByZXNwb25zZTogdm9pZFxuICB9XG4gIGxpanN0X251bW1lcl92ZXJ3aWpkZXJlbjoge1xuICAgIHJlcXVlc3Q6IHtcbiAgICAgIGxpanN0OiBudW1iZXJcbiAgICAgIG51bW1lcjogbnVtYmVyXG4gICAgfVxuICAgIHJlc3BvbnNlOiB2b2lkXG4gIH1cbiAgZ2V0X2dlc2VsZWN0ZWVyZGVfbnVtbWVyczoge1xuICAgIHJlcXVlc3Q6IHtcbiAgICAgIGxpanN0OiBudW1iZXJcbiAgICB9XG4gICAgcmVzcG9uc2U6IHtcbiAgICAgIGlkOiBudW1iZXJcbiAgICAgIHRpdGVsOiBzdHJpbmdcbiAgICAgIGFydGllc3Q6IHN0cmluZ1xuICAgICAgamFhcjogbnVtYmVyXG4gICAgfVtdXG4gIH1cbiAgdnVsX2RhdGF0YWJsZXM6IHtcbiAgICByZXF1ZXN0OiB7W2luZGV4OnN0cmluZ106IGFueX1cbiAgICByZXNwb25zZToge1xuICAgICAgZHJhdzogbnVtYmVyXG4gICAgICByZWNvcmRzVG90YWw6IG51bWJlclxuICAgICAgcmVjb3Jkc0ZpbHRlcmVkOiBudW1iZXJcbiAgICAgIGRhdGE6IHN0cmluZ1tdW11cbiAgICB9XG4gIH1cbiAgZ2V0X3Jlc3VsdGF0ZW5fbGFiZWxzOiB7XG4gICAgcmVxdWVzdDoge1xuICAgICAgbGlqc3Q6IG51bWJlclxuICAgIH1cbiAgICByZXNwb25zZTogc3RyaW5nW11cbiAgfVxuICBnZXRfcmVzdWx0YXRlbjoge1xuICAgIHJlcXVlc3Q6IHtcbiAgICAgIGxpanN0OiBudW1iZXJcbiAgICB9XG4gICAgcmVzcG9uc2U6IHtcbiAgICAgIG51bW1lcjoge1xuICAgICAgICBhcnRpZXN0OiBzdHJpbmdcbiAgICAgICAgaWQ6IG51bWJlclxuICAgICAgICBpc192cmlqZWtldXplOiBib29sZWFuXG4gICAgICAgIHRpdGVsOiBzdHJpbmdcbiAgICAgIH1cbiAgICAgIHN0ZW1tZW46IHtcbiAgICAgICAgaXA6IHN0cmluZ1xuICAgICAgICBpc19iZWhhbmRlbGQ6IGJvb2xlYW5cbiAgICAgICAgc3RlbW1lcl9pZDogbnVtYmVyXG4gICAgICAgIHRpbWVzdGFtcDogc3RyaW5nXG4gICAgICAgIHRvZWxpY2h0aW5nOiBzdHJpbmdcbiAgICAgICAgdmVsZGVuOiB7XG4gICAgICAgICAgdHlwZTogc3RyaW5nXG4gICAgICAgICAgd2FhcmRlOiBzdHJpbmdcbiAgICAgICAgfVtdXG4gICAgICB9W11cbiAgICB9W11cbiAgfVxuICBnZXRfbGlqc3RfbWV0YWRhdGE6IHtcbiAgICByZXF1ZXN0OiB7XG4gICAgICBsaWpzdDogbnVtYmVyXG4gICAgfVxuICAgIHJlc3BvbnNlOiB7XG4gICAgICBuYWFtOiBzdHJpbmdcbiAgICAgIG51bW1lcl9pZHM6IG51bWJlcltdXG4gICAgICBpZnJhbWVfdXJsOiBzdHJpbmdcbiAgICB9XG4gIH1cbiAgZ2V0X21ldGFkYXRhOiB7XG4gICAgcmVxdWVzdDoge31cbiAgICByZXNwb25zZToge1xuICAgICAgb3JnYW5pc2F0aWU6IHN0cmluZ1xuICAgICAgbGlqc3Rlbjoge1xuICAgICAgICBpZDogbnVtYmVyXG4gICAgICAgIG5hYW06IHN0cmluZ1xuICAgICAgfVtdXG4gICAgICBuaW1idXNfdXJsOiBzdHJpbmdcbiAgICAgIHRvdGFhbF9hYW50YWxfbnVtbWVyczogbnVtYmVyXG4gICAgfVxuICB9XG4gIGdldF9hbGxlX3ZlbGRlbjoge1xuICAgIHJlcXVlc3Q6IHt9XG4gICAgcmVzcG9uc2U6IHtcbiAgICAgIGlkOiBudW1iZXIsXG4gICAgICB0b25lbjogZmFsc2UsXG4gICAgICBsYWJlbDogc3RyaW5nLFxuICAgICAgdmVycGxpY2h0OiBmYWxzZVxuICAgIH1bXVxuICB9XG4gIGdldF9iZWhlZXJfbGlqc3RkYXRhOiB7XG4gICAgcmVxdWVzdDoge1xuICAgICAgbGlqc3Q6IG51bWJlclxuICAgIH1cbiAgICByZXNwb25zZToge1xuICAgICAgbmFhbTogc3RyaW5nLFxuICAgICAgaXNfYWN0aWVmOiBib29sZWFuLFxuICAgICAgbWlua2V1emVzOiBudW1iZXIsXG4gICAgICBtYXhrZXV6ZXM6IG51bWJlcixcbiAgICAgIHZyaWpla2V1emVzOiBudW1iZXIsXG4gICAgICBzdGVtbWVuX3Blcl9pcDogbnVtYmVyIHwgbnVsbCxcbiAgICAgIGFydGllc3RfZWVubWFsaWc6IGJvb2xlYW4sXG4gICAgICBtYWlsX3N0ZW1tZXJzOiBib29sZWFuLFxuICAgICAgcmFuZG9tX3ZvbGdvcmRlOiBib29sZWFuLFxuICAgICAgcmVjYXB0Y2hhOiBib29sZWFuLFxuICAgICAgZW1haWw6IHN0cmluZyxcbiAgICAgIGJlZGFua3RfdGVrc3Q6IHN0cmluZyxcbiAgICAgIHZlbGRlbjoge1xuICAgICAgICBpZDogbnVtYmVyLFxuICAgICAgICB0b25lbjogYm9vbGVhbixcbiAgICAgICAgbGFiZWw6IHN0cmluZyxcbiAgICAgICAgdmVycGxpY2h0OiBib29sZWFuXG4gICAgICB9W11cbiAgICB9XG4gIH1cbiAgbG9naW46IHtcbiAgICByZXF1ZXN0OiB7fVxuICAgIHJlc3BvbnNlOiB2b2lkXG4gIH1cbn07XG5cbi8qKlxuICogVm9lcnQgZWVuIHBvc3QtcmVxdWVzdCB1aXQgYWFuIGRlIHNlcnZlci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBvc3Q8RiBleHRlbmRzIGtleW9mIEFqYXhNYXA+KFxuICBmdW5jdGllOiBGLFxuICBkYXRhOiBBamF4TWFwW0ZdWydyZXF1ZXN0J11cbik6IFByb21pc2U8QWpheE1hcFtGXVsncmVzcG9uc2UnXT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICB4aHIub3BlbignUE9TVCcsICdhamF4LnBocCcsIHRydWUpO1xuICAgICAgeGhyLm9ubG9hZCA9IChwb3N0X3ZlcndlcmtfcmVzcG9uczxBamF4TWFwW0ZdWydyZXNwb25zZSddPikuYmluZCh1bmRlZmluZWQsIHhociwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgIHhoci5vbmVycm9yID0gKHBvc3RfdmVyd2Vya19yZXNwb25zPEFqYXhNYXBbRl1bJ3Jlc3BvbnNlJ10+KS5iaW5kKHVuZGVmaW5lZCwgeGhyLCByZXNvbHZlLCByZWplY3QpO1xuXG4gICAgICBsZXQgc2VuZF9kYXRhOiBGb3JtRGF0YSB8IHN0cmluZztcbiAgICAgIGlmICggZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhICkge1xuICAgICAgICAgIGRhdGEuYXBwZW5kKCdmdW5jdGllJywgZnVuY3RpZSk7XG4gICAgICAgICAgc2VuZF9kYXRhID0gZGF0YTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VuZF9kYXRhID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgZnVuY3RpZTogZnVuY3RpZSxcbiAgICAgICAgICAgIC4uLmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICAgIH1cbiAgICAgIHhoci5zZW5kKHNlbmRfZGF0YSk7XG4gIH0pO1xufVxuXG4vKipcbiogVmVyd2Vya3QgZWVuIHNlcnZlcnJlc3BvbnMuXG4qIEBwYXJhbSByZXNvbHZlIC0gVWl0IHRlIHZvZXJlbiBmdW5jdGllIGJpaiBlZW4gc3VjY2Vzdm9sbGUgdWl0dm9lcmluZy5cbiogQHBhcmFtIHJlamVjdCAtIFVpdCB0ZSB2b2VyZW4gZnVuY3RpZSBiaWogZWVuIG1pc2x1a3QgcmVxdWVzdC5cbiovXG5mdW5jdGlvbiBwb3N0X3ZlcndlcmtfcmVzcG9uczxUPihcbiAgeGhyOiBYTUxIdHRwUmVxdWVzdCxcbiAgcmVzb2x2ZTogKHJlc3BvbnM6IFQpID0+IHZvaWQsXG4gIHJlamVjdDogKGVycm9yOiBFcnJvcikgPT4gdm9pZCxcbiAgZXZlbnQ6IFByb2dyZXNzRXZlbnRcbikge1xuICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKTtcbiAgICAgIGlmICggZGF0YS5lcnJvciAhPT0gZmFsc2UgKSB7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihkYXRhLmVycm9yZGF0YSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKGRhdGEuZGF0YSk7XG4gICAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZWplY3QobmV3IEVycm9yKHhoci5yZXNwb25zZVRleHQpKTtcbiAgfVxufVxuIiwiLy8gTGlicmFyaWVzIGpzXG5pbXBvcnQgJ2Jvb3RzdHJhcCc7XG5pbXBvcnQgRGF0YVRhYmxlLCAqIGFzIGRhdGF0YWJsZXMgZnJvbSAnZGF0YXRhYmxlcy5uZXQtZHQnO1xuXG4vLyBQcm9qZWN0IGpzXG5pbXBvcnQgKiBhcyBzZXJ2ZXIgZnJvbSAnQG11emlla2xpanN0ZW4vc2VydmVyJztcbmltcG9ydCAqIGFzIGZ1bmN0aWVzIGZyb20gJ0BtdXppZWtsaWpzdGVuL2Z1bmN0aWVzJztcblxuLy8gY3NzXG5pbXBvcnQgJy9zcmMvc2Nzcy9tdXppZWtsaWpzdC5zY3NzJztcblxuLy8gQWZiZWVsZGluZ2VuXG4vLyBpbXBvcnQgJy9hc3NldHMvYWZiZWVsZGluZ2VuL2Zic2hhcmVfdG9wMTAwLmpwZyc7XG5cbi8qKlxuICogRWVuIGRvb3IgZGUgYmV6b2VrZXIgZ2VzZWxlY3RlZXJkIG51bW1lci5cbiAqIE1hYWt0IGVlbiByZWdlbCBpbiBkZSBET00gYmlqIGRlIGdlc2VsZWN0ZWVyZGUgbnVtbWVycyBlbiBpbnB1dHMgaW4gaGV0IGZvcm11bGllciB6b2RhdCBkZSBudW1tZXItaWRzIGJpaiBoZXQgc3RlbW1lblxuICogaW4gZGUgZm9ybXVsaWVydmVsZGVuIHN0YWFuLlxuICovXG5jbGFzcyBOdW1tZXIge1xuXG4gIC8qKiBAdHlwZSB7SFRNTFRhYmxlUm93RWxlbWVudH0gKi9cbiAgZV90cjtcblxuICAvKipcbiAgICogXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBudW1tZXJfaWQgXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRlbCBcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFydGllc3QgXG4gICAqL1xuICBjb25zdHJ1Y3RvcihudW1tZXJfaWQsIHRpdGVsLCBhcnRpZXN0KSB7XG4gICAgdGhpcy5lX3RyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGVfdGRfdGl0ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGVfdGRfdGl0ZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGl0ZWwpKTtcbiAgICB0aGlzLmVfdHIuYXBwZW5kQ2hpbGQoZV90ZF90aXRlbCk7XG5cbiAgICBjb25zdCBlX3RkX2FydGllc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGVfdGRfYXJ0aWVzdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShhcnRpZXN0KSk7XG4gICAgdGhpcy5lX3RyLmFwcGVuZENoaWxkKGVfdGRfYXJ0aWVzdCk7XG5cbiAgICBjb25zdCBlX3RkX3RvZWxpY2h0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBlX3RkX3RvZWxpY2h0aW5nLmNsYXNzTGlzdC5hZGQoJ3JlbWFyaycpO1xuICAgIHRoaXMuZV90ci5hcHBlbmRDaGlsZChlX3RkX3RvZWxpY2h0aW5nKTtcblxuICAgIGNvbnN0IGVfdG9lbGljaHRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGVfdG9lbGljaHRpbmcudHlwZSA9ICd0ZXh0JztcbiAgICBlX3RvZWxpY2h0aW5nLmNsYXNzTGlzdC5hZGQoJ2Zvcm0tY29udHJvbCcpO1xuICAgIGVfdG9lbGljaHRpbmcubWF4TGVuZ3RoID0gMTAyNDtcbiAgICBlX3RvZWxpY2h0aW5nLm5hbWUgPSBgbnVtbWVyc1ske251bW1lcl9pZH1dW3RvZWxpY2h0aW5nXWA7XG4gICAgZV90ZF90b2VsaWNodGluZy5hcHBlbmRDaGlsZChlX3RvZWxpY2h0aW5nKTtcblxuICAgIGNvbnN0IGVfaGlkZGVuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBlX2hpZGRlbi50eXBlID0gJ2hpZGRlbic7XG4gICAgZV9oaWRkZW4ubmFtZSA9IGBudW1tZXJzWyR7bnVtbWVyX2lkfV1baWRdYDtcbiAgICBlX2hpZGRlbi52YWx1ZSA9IG51bW1lcl9pZDtcbiAgICB0aGlzLmVfdHIuYXBwZW5kQ2hpbGQoZV9oaWRkZW4pO1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2tldXplcyB0Ym9keScpLmFwcGVuZENoaWxkKHRoaXMuZV90cik7XG4gIH1cblxuICAvKipcbiAgICogVmVyd2lqZGVydCBoZXQgbnVtbWVyIHVpdCBkZSBET00uXG4gICAqL1xuICBkZXN0cm95KCkge1xuICAgIHRoaXMuZV90ci5yZW1vdmUoKTtcbiAgfVxuXG59XG5cbi8qKlxuICogRWVuIGludm9lcnZlbGQgbWV0IGluZm8gb3ZlciBkZSBzdGVtbWVyLlxuICovXG5jbGFzcyBJbnZvZXJ2ZWxkIHtcblxuICAvKiogQHR5cGUge0hUTUxEaXZFbGVtZW50fSAqL1xuICBlX2Zvcm1fZ3JvdXA7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIGlkLFxuICAgIGxhYmVsLFxuICAgIGxlZWdfZmVlZGJhY2ssXG4gICAgbWF4LFxuICAgIG1heGxlbmd0aCxcbiAgICBtaW4sXG4gICAgbWlubGVuZ3RoLFxuICAgIHBsYWNlaG9sZGVyLFxuICAgIHR5cGUsXG4gICAgdmVycGxpY2h0XG4gIH0pIHtcbiAgICBjb25zdCBpZF9zdHIgPSBgdmVsZC0ke2lkfWA7XG4gICAgY29uc3QgbmFhbSA9IGB2ZWxkZW5bJHtpZH1dYDtcblxuICAgIHRoaXMuZV9mb3JtX2dyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5lX2Zvcm1fZ3JvdXAuY2xhc3NMaXN0LmFkZCgnZm9ybS1ncm91cCcsICdyb3cnKTtcblxuICAgIGNvbnN0IGVfbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIHRoaXMuZV9mb3JtX2dyb3VwLmFwcGVuZENoaWxkKGVfbGFiZWwpO1xuICAgIGVfbGFiZWwuY2xhc3NMaXN0LmFkZCgnY29udHJvbC1sYWJlbCcsICdjb2wtc20tMicpO1xuICAgIGVfbGFiZWwuc2V0QXR0cmlidXRlKCdmb3InLCBpZF9zdHIpO1xuICAgIGVfbGFiZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGFiZWwpKTtcblxuICAgIGNvbnN0IGVfY29sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5lX2Zvcm1fZ3JvdXAuYXBwZW5kQ2hpbGQoZV9jb2wpO1xuICAgIGVfY29sLmNsYXNzTGlzdC5hZGQoJ2NvbC1zbS0xMCcpO1xuXG4gICAgbGV0IGVfaW5wdXQ7XG4gICAgaWYgKCB0eXBlID09PSAndGV4dGFyZWEnICkge1xuICAgICAgZV9pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgICBlX2lucHV0LnJvd3MgPSA1O1xuICAgIH0gZWxzZSB7XG4gICAgICBlX2lucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgIGlmICggdHlwZSA9PT0gJ3Bvc3Rjb2RlJyApIHtcbiAgICAgICAgZV9pbnB1dC50eXBlID0gJ3RleHQnO1xuICAgICAgICBlX2lucHV0LmNsYXNzTGlzdC5hZGQoJ3Bvc3Rjb2RlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlX2lucHV0LnR5cGUgPSB0eXBlO1xuICAgICAgfVxuICAgICAgaWYgKCBOdW1iZXIuaXNJbnRlZ2VyKG1heCkgKSB7XG4gICAgICAgIGVfaW5wdXQubWF4ID0gbWF4O1xuICAgICAgfVxuICAgICAgaWYgKCBOdW1iZXIuaXNJbnRlZ2VyKG1pbikgKSB7XG4gICAgICAgIGVfaW5wdXQubWluID0gbWluO1xuICAgICAgfVxuICAgIH1cbiAgICBlX2NvbC5hcHBlbmRDaGlsZChlX2lucHV0KTtcbiAgICBlX2lucHV0LmNsYXNzTGlzdC5hZGQoJ2Zvcm0tY29udHJvbCcpO1xuICAgIGVfaW5wdXQuaWQgPSBpZF9zdHI7XG4gICAgZV9pbnB1dC5uYW1lID0gbmFhbTtcbiAgICBlX2lucHV0LnNldEF0dHJpYnV0ZSgnZGF0YS1sZWVnLWZlZWRiYWNrJywgbGVlZ19mZWVkYmFjayk7XG4gICAgaWYgKCBOdW1iZXIuaXNJbnRlZ2VyKG1heGxlbmd0aCkgKSB7XG4gICAgICBlX2lucHV0Lm1heExlbmd0aCA9IG1heGxlbmd0aDtcbiAgICB9XG4gICAgaWYgKCBOdW1iZXIuaXNJbnRlZ2VyKG1pbmxlbmd0aCkgKSB7XG4gICAgICBlX2lucHV0Lm1pbkxlbmd0aCA9IG1pbmxlbmd0aDtcbiAgICB9XG4gICAgaWYgKCB0eXBlb2YgcGxhY2Vob2xkZXIgPT09ICdzdHJpbmcnICkge1xuICAgICAgZV9pbnB1dC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xuICAgIH1cbiAgICBlX2lucHV0LnJlcXVpcmVkID0gdmVycGxpY2h0O1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm11bGllci12ZWxkZW4nKS5hcHBlbmRDaGlsZCh0aGlzLmVfZm9ybV9ncm91cCk7XG4gIH1cblxufVxuXG5jbGFzcyBTdGVtVmlldyB7XG5cbiAgLyoqIEB0eXBlIHtudW1iZXJ9ICovXG4gIGxpanN0X2lkO1xuICAvKiogQHR5cGUge251bWJlcn0gKi9cbiAgbWlua2V1emVzO1xuICAvKiogQHR5cGUge251bWJlcn0gKi9cbiAgbWF4a2V1emVzO1xuICAvKiogQHR5cGUge2Jvb2xlYW59ICovXG4gIGlzX2FydGllc3RfZWVubWFsaWc7XG4gIC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cbiAgaGVlZnRfcmVjYXB0Y2hhO1xuICAvKiogQHR5cGUge3tba2V5OiBudW1iZXJdOiBOdW1tZXJ9fSAqL1xuICBnZXNlbGVjdGVlcmRlX251bW1lcnM7XG4gIC8qKiBAdHlwZSB7QXJyYXl9ICovXG4gIGdlc2VsZWN0ZWVyZGVfYXJ0aWVzdGVuO1xuICAvKiogQHR5cGUge0hUTUxUYWJsZUVsZW1lbnR9ICovXG4gIGVfZGF0YXRhYmxlO1xuICAvKiogQHR5cGUge0hUTUxUYWJsZVNlY3Rpb25FbGVtZW50fSAqL1xuICBlX2RhdGF0YWJsZV9ib2R5O1xuICAvKiogQHR5cGUge19BcGl9ICovXG4gIGRhdGF0YWJsZTtcbiAgLyoqIEB0eXBlIHtIVE1MQm9keUVsZW1lbnR9ICovXG4gIGVfYm9keTtcbiAgLyoqIEB0eXBlIHtIVE1MRm9ybUVsZW1lbnR9ICovXG4gIGVfa2V1emVmb3JtdWxpZXI7XG4gIC8qKiBAdHlwZSB7SFRNTEZvcm1FbGVtZW50fSAqL1xuICBlX3N0ZW1tZXJmb3JtdWxpZXI7XG4gIHNlcnZlcmRhdGFfcHJvbWlzZTtcbiAgLyoqIEB0eXBlIHtIVE1MRGl2RWxlbWVudH0gKi9cbiAgZV9lcnJvcm1zZztcbiAgcmFuZG9tX3NlZWQ7XG4gIFxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmxpanN0X2lkID0gKG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCkpLmdldCgnbGlqc3QnKTtcbiAgICB0aGlzLmVfYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JykuaXRlbSgwKTtcbiAgICB0aGlzLmVfa2V1emVmb3JtdWxpZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2V1emVmb3JtdWxpZXInKTtcbiAgICB0aGlzLmVfc3RlbW1lcmZvcm11bGllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGVtbWVyZm9ybXVsaWVyJyk7XG4gICAgdGhpcy5nZXNlbGVjdGVlcmRlX251bW1lcnMgPSB7fTtcbiAgICB0aGlzLmdlc2VsZWN0ZWVyZGVfYXJ0aWVzdGVuID0gW107XG4gICAgdGhpcy5lX2Vycm9ybXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9ybXNnJyk7XG4gICAgdGhpcy5yYW5kb21fc2VlZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIqKjE2KTtcblxuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgYXN5bmMgaW5pdCgpIHtcbiAgICBhd2FpdCB0aGlzLnZ1bF9zZXJ2ZXJkYXRhKCk7XG5cbiAgICB0aGlzLmVfYm9keS5jbGFzc0xpc3QuYWRkKCdnZWxhZGVuJyk7XG5cbiAgICBjb25zdCBlX2RhdGF0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW1tZXJzJyk7XG5cbiAgICB0aGlzLmRhdGF0YWJsZSA9IG5ldyBEYXRhVGFibGUoZV9kYXRhdGFibGUsIHtcbiAgICAgIHByb2Nlc3Npbmc6IHRydWUsXG4gICAgICBzZXJ2ZXJTaWRlOiB0cnVlLFxuICAgICAgYWpheDogKGRhdGEsIGNhbGxiYWNrLCBzZXR0aW5ncykgPT4ge1xuICAgICAgICBkYXRhLmxpanN0ID0gdGhpcy5saWpzdF9pZDtcbiAgICAgICAgZGF0YS5pc192cmlqZWtldXplID0gZmFsc2U7XG4gICAgICAgIGRhdGEucmFuZG9tX3NlZWQgPSB0aGlzLnJhbmRvbV9zZWVkO1xuICAgICAgICBmdW5jdGllcy52dWxfZGF0YXRhYmxlcyhkYXRhLCBjYWxsYmFjaywgc2V0dGluZ3MpO1xuICAgICAgfSxcbiAgICAgIGJMZW5ndGhDaGFuZ2U6IGZhbHNlLFxuICAgICAgaURpc3BsYXlMZW5ndGg6IDUwLFxuICAgICAgY29sdW1uRGVmczogW1xuICAgICAgICB7XG4gICAgICAgICAgdGFyZ2V0czogMCxcbiAgICAgICAgICBzZWFyY2hhYmxlOiBmYWxzZSxcbiAgICAgICAgICBvcmRlcmFibGU6IGZhbHNlLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2R0LWJvZHktY2VudGVyJyxcbiAgICAgICAgICByZW5kZXI6IChkYXRhLCB0eXBlLCBmdWxsLCBtZXRhKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIj4nO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIG9yZGVyOiBbXG4gICAgICAgIFsyLCAnYXNjJ10sXG4gICAgICAgIFsxLCAnYXNjJ11cbiAgICAgIF0sXG4gICAgICBvcmRlcmluZzogIShhd2FpdCB0aGlzLmlzX3JhbmRvbV92b2xnb3JkZSgpKSxcbiAgICAgIC8vIHJvd0NhbGxiYWNrOiB0aGlzLnJvd19jYWxsYmFjay5iaW5kKHRoaXMpLFxuICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgbGVuZ3RoTWVudTogJ19NRU5VXyBudW1tZXJzIHBlciBwYWdpbmEnLFxuICAgICAgICB6ZXJvUmVjb3JkczogJ0dlZW4gbnVtbWVycyBnZXZvbmRlbicsXG4gICAgICAgIGluZm86ICdQYWdpbmEgX1BBR0VfIHZhbiBfUEFHRVNfJyxcbiAgICAgICAgaW5mb0VtcHR5OiAnR2VlbiBudW1tZXJzIGdldm9uZGVuJyxcbiAgICAgICAgaW5mb0ZpbHRlcmVkOiAnKGdlZmlsdGVyZCB2YW4gX01BWF8gdG90YWFsKScsXG4gICAgICAgIHNlYXJjaDogJ1pvZWtlbjonLFxuICAgICAgICBwYWdpbmF0ZToge1xuICAgICAgICAgIGZpcnN0OiAnRWVyc3RlJyxcbiAgICAgICAgICBsYXN0OiAnTGFhdHN0ZScsXG4gICAgICAgICAgbmV4dDogJ1ZvbGdlbmRlJyxcbiAgICAgICAgICBwcmV2aW91czogJ1ZvcmlnZSdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuZV9kYXRhdGFibGVfYm9keSA9IGVfZGF0YXRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Ym9keScpLml0ZW0oMCk7XG5cbiAgICBmb3IgKCBjb25zdCBlbGVtIG9mIHRoaXMuZV9zdGVtbWVyZm9ybXVsaWVyLmVsZW1lbnRzICkge1xuICAgICAgdGhpcy5hZGRfdHJpbV9oYW5kbGVyKGVsZW0pO1xuICAgIH1cblxuICAgIC8vIEtsaWsgb3AgZWVuIGNoZWNrYm94IG9mIHRhYmVscmlqIG1ldCBlZW4gbnVtbWVyLlxuICAgIHRoaXMuZV9kYXRhdGFibGVfYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMudGFiZWxfa2xpa19oYW5kbGVyLmJpbmQodGhpcykpO1xuXG4gICAgLy8gSW5zdHVyZW4ga2V1emVmb3JtdWxpZXIuIEdlYmV1cnQgaW4gcHJpbmNpcGUgbmlldCB3YW50IGVyIGlzIGdlZW4ga25vcC5cbiAgICB0aGlzLmVfa2V1emVmb3JtdWxpZXIuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRfaGFuZGxlci5iaW5kKHRoaXMpKTtcblxuICAgIC8vIEluc3R1cmVuXG4gICAgdGhpcy5lX3N0ZW1tZXJmb3JtdWxpZXIuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRfaGFuZGxlci5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWdWx0IHNlcnZlcmRhdGEgaW4gaW4gaGV0IG9iamVjdCBlbiBkZSBET00uXG4gICAqL1xuICBhc3luYyB2dWxfc2VydmVyZGF0YSgpIHtcbiAgICBsZXQgc2VydmVyZGF0YTtcbiAgICB0cnkge1xuICAgICAgc2VydmVyZGF0YSA9IGF3YWl0IHRoaXMuZ2V0X3NlcnZlcmRhdGEoKTtcbiAgICB9IGNhdGNoIChtc2cpIHtcbiAgICAgIHRoaXMuZXJyb3IobXNnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5taW5rZXV6ZXMgPSBzZXJ2ZXJkYXRhLm1pbmtldXplcztcbiAgICB0aGlzLm1heGtldXplcyA9IHNlcnZlcmRhdGEubWF4a2V1emVzO1xuICAgIHRoaXMuaXNfYXJ0aWVzdF9lZW5tYWxpZyA9IHNlcnZlcmRhdGEuaXNfYXJ0aWVzdF9lZW5tYWxpZztcbiAgICBjb25zdCB0aXRlbCA9IGAke3NlcnZlcmRhdGEub3JnYW5pc2F0aWV9IOKAkyAke3NlcnZlcmRhdGEubGlqc3RfbmFhbX1gXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RpdGxlJykuaXRlbSgwKS5pbm5lclRleHQgPSB0aXRlbDtcbiAgICBpZiAoIHNlcnZlcmRhdGEuaGVlZnRfZ2VicnVpa19yZWNhcHRjaGEgKSB7XG4gICAgICB0aGlzLmVfYm9keS5jbGFzc0xpc3QuYWRkKCdoZWVmdC1yZWNhcHRjaGEnKTtcbiAgICB9XG4gICAgaWYgKCBzZXJ2ZXJkYXRhLmlzX2FjdGllZiApIHtcbiAgICAgIHRoaXMuZV9ib2R5LmNsYXNzTGlzdC5hZGQoJ2lzLWFjdGllZicpO1xuICAgIH1cbiAgICB0aGlzLmVfa2V1emVmb3JtdWxpZXIuZWxlbWVudHMubGlqc3QudmFsdWUgPSB0aGlzLmxpanN0X2lkO1xuICAgIGZvciAoIGNvbnN0IHZlbGRkYXRhIG9mIHNlcnZlcmRhdGEudmVsZGVuICkge1xuICAgICAgbmV3IEludm9lcnZlbGQodmVsZGRhdGEpO1xuICAgIH1cbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBzZXJ2ZXJkYXRhLnZyaWpla2V1emVzOyBpKysgKSB7XG4gICAgICB0aGlzLnZyaWprZXV6ZV90b2V2b2VnZW4oaSwgc2VydmVyZGF0YS52cmlqZWtldXplcyk7XG4gICAgfVxuICAgIGZvciAoIGNvbnN0IGVfY2FwdGNoYSBvZiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZy1yZWNhcHRjaGEnKSApIHtcbiAgICAgIGVfY2FwdGNoYS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2l0ZWtleScsIHNlcnZlcmRhdGEucmVjYXB0Y2hhX3NpdGVrZXkpO1xuICAgICAgY29uc3QgZV9zY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIGVfc2NyaXB0LnNyYyA9ICdodHRwczovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkuanM/aGw9bmwnO1xuICAgICAgZV9jYXB0Y2hhLnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZV9zY3JpcHQpO1xuICAgIH1cbiAgICBmb3IgKCBjb25zdCBlX29yZ2FuaXNhdGllIG9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vcmdhbmlzYXRpZScpICkge1xuICAgICAgZV9vcmdhbmlzYXRpZS5pbm5lclRleHQgPSBzZXJ2ZXJkYXRhLm9yZ2FuaXNhdGllO1xuICAgIH1cbiAgICBmb3IgKCBjb25zdCBlX3ByaXZhY3lfdXJsIG9mIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2EucHJpdmFjeS11cmwnKSApIHtcbiAgICAgIGVfcHJpdmFjeV91cmwuc2V0QXR0cmlidXRlKCdocmVmJywgc2VydmVyZGF0YS5wcml2YWN5X3VybCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhYWx0IGdlZ2V2ZW5zIG92ZXIgZGUgc3RlbWxpanN0IHZhbiBkZSBzZXJ2ZXIuXG4gICAqL1xuICBnZXRfc2VydmVyZGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5zZXJ2ZXJkYXRhX3Byb21pc2UgPz89IHNlcnZlci5wb3N0KCdnZXRfc3RlbWxpanN0X2Zyb250ZW5kX2RhdGEnLCB7XG4gICAgICBsaWpzdDogdGhpcy5saWpzdF9pZFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fVxuICAgKi9cbiAgYXN5bmMgaXNfcmFuZG9tX3ZvbGdvcmRlKCkge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy5nZXRfc2VydmVyZGF0YSgpKS5yYW5kb21fdm9sZ29yZGU7XG4gIH1cblxuICAvKipcbiAgICogVmVyd2Vya3QgaGV0IHN0ZW1tZW4uXG4gICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IFxuICAgKi9cbiAgYXN5bmMgc3VibWl0X2hhbmRsZXIoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGlmICggT2JqZWN0LmtleXModGhpcy5nZXNlbGVjdGVlcmRlX251bW1lcnMpLmxlbmd0aCA8IHRoaXMubWlua2V1emVzICkge1xuICAgICAgYWxlcnQoYFUgbW9ldCBtaW1pbWFhbCAke3RoaXMubWlua2V1emVzfSBudW1tZXJzIHNlbGVjdGVyZW4uYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICggdGhpcy5oZWVmdF9yZWNhcHRjaGEgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ctcmVjYXB0Y2hhLXJlc3BvbnNlJykudmFsdWUgPT09ICcnICkge1xuICAgICAgYWxlcnQoJ1BsYWF0cyBlZW4gdmlua2plIGEudS5iLicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAoIGNvbnN0IHZlbGQgb2YgdGhpcy5lX3N0ZW1tZXJmb3JtdWxpZXIuZWxlbWVudHMgKSB7XG4gICAgICBpZiAoIHZlbGQucmVxdWlyZWQgJiYgdmVsZC52YWx1ZSA9PT0gJycgKSB7XG4gICAgICAgIGFsZXJ0KHZlbGQuZ2V0QXR0cmlidXRlKCdkYXRhLWxlZWctZmVlZGJhY2snKSk7XG4gICAgICAgIHZlbGQuZm9jdXMoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCB2ZWxkLm1pbiA+IDAgJiYgdmVsZC52YWx1ZUFzTnVtYmVyIDwgdmVsZC5taW4gKSB7XG4gICAgICAgIGFsZXJ0KGBEZSB3YWFyZGUgdmFuICR7dmVsZC5uYW1lfSBpcyB0ZSBsYWFnLiBIZXQgbWluaW11bSBpcyAke3ZlbGQubWlufWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoIHZlbGQubWF4ID4gMCAmJiB2ZWxkLnZhbHVlQXNOdW1iZXIgPiB2ZWxkLm1heCApIHtcbiAgICAgICAgYWxlcnQoYERlIHdhYXJkZSB2YW4gJHt2ZWxkLm5hbWV9IGlzIHRlIGhvb2cuIEhldCBtYXhpbXVtIGlzICR7dmVsZC5tYXh9YCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICggdmVsZC5taW5MZW5ndGggPiAwICYmIHZlbGQudmFsdWUubGVuZ3RoIDwgdmVsZC5taW5MZW5ndGggKSB7XG4gICAgICAgIGFsZXJ0KGBEZSBpbnZvZXIgdmFuICR7dmVsZC5uYW1lfSBpcyB0ZSBrb3J0LiBEZSBtaW5pbXVtbGVuZ3RlIGlzICR7dmVsZC5taW5MZW5naHR9YCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICggdmVsZC5tYXhMZW5ndGggPiAwICAmJiB2ZWxkLnZhbHVlLmxlbmd0aCA+IHZlbGQubWF4TGVuZ3RoICkge1xuICAgICAgICBhbGVydChgRGUgaW52b2VyIHZhbiAke3ZlbGQubmFtZX0gaXMgdGUgbGFuZy4gRGUgbWF4aW11bWxlbmd0ZSBpcyAke3ZlbGQubWF4TGVuZ3RofWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZmQgPSBuZXcgRm9ybURhdGEodGhpcy5lX3N0ZW1tZXJmb3JtdWxpZXIpO1xuICAgIGZkLmFwcGVuZCgnbGlqc3QnLCB0aGlzLmxpanN0X2lkKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHNlcnZlci5wb3N0KCdzdGVtJywgZmQpO1xuICAgICAgY29uc3QgaG9vZ3RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0ZW1zZWdtZW50Jykub2Zmc2V0SGVpZ2h0IC0gMTAwO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0ZW1zZWdtZW50LXBsYWNlaG9sZGVyJykuc3R5bGUuaGVpZ2h0ID0gYCR7aG9vZ3RlfXB4YDtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHQnKS5pbm5lckhUTUwgPSBkYXRhO1xuICAgICAgdGhpcy5lX2JvZHkuY2xhc3NMaXN0LmFkZCgnZ2VzdGVtZCcpO1xuICAgIH0gY2F0Y2ggKG1zZykge1xuICAgICAgYWxlcnQobXNnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogS25pcHQgc3BhdGllcyBlbiBhbmRlcmUgbGVnZSB0ZWtlbnMgd2VnIGFhbiBoZXQgYmVnaW4gZW4gZWluZGUgdmFuIHRla3N0dmVsZGVuLlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlIFxuICAgKi9cbiAgYWRkX3RyaW1faGFuZGxlcihlbGVtKSB7XG4gICAgY29uc3QgdHlwZXMgPSBbXG4gICAgICAnZW1haWwnLFxuICAgICAgJ21vbnRoJyxcbiAgICAgICdudW1iZXInLFxuICAgICAgJ3RlbCcsXG4gICAgICAndGV4dCcsXG4gICAgICAndGltZScsXG4gICAgICAndXJsJyxcbiAgICAgICd3ZWVrJ1xuICAgIF07XG4gICAgaWYgKCBlbGVtIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCAmJiB0eXBlcy5pbmNsdWRlcyhlbGVtLnR5cGUpIHx8IGVsZW0gaW5zdGFuY2VvZiBIVE1MVGV4dEFyZWFFbGVtZW50ICkge1xuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZSA9PiB7XG4gICAgICAgIGUudGFyZ2V0LnZhbHVlID0gZS50YXJnZXQudmFsdWUudHJpbSgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogUmVnZWx0IGhldCBzZWxlY3RlcmVuIG9mIGRlc2VsZWN0ZXJlbiB2YW4gZWVuIG51bW1lciBpbiBkZSBsaWpzdC5cbiAgICogQHBhcmFtIHtFdmVudH0gZSBcbiAgICogQHJldHVybnMgXG4gICAqL1xuICB0YWJlbF9rbGlrX2hhbmRsZXIoZSkge1xuICAgIGNvbnN0IGVfcmlqID0gZS50YXJnZXQuY2xvc2VzdCgndHInKTtcbiAgICBjb25zdCBlX2NoZWNrYm94ID0gZV9yaWoucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJyk7XG4gICAgY29uc3QgY2hlY2tib3hfa2xpayA9IGUudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudDtcbiAgICAvLyBCaWogaGV0IGtsaWtrZW4gb3AgZGUgY2hlY2tib3ggemVsZiBpcyBkZXplIGFsIGdlc2VsZWN0ZWVyZCxcbiAgICAvLyBiaWogaGV0IGtsaWtrZW4gb3AgZWVuIGFuZGVyZSBwbGVrIGluIGRlIHRhYmVsIG5pZXQuXG4gICAgY29uc3Qgc2VsZWN0ZXJlbiA9IGNoZWNrYm94X2tsaWsgJiYgZV9jaGVja2JveC5jaGVja2VkIHx8ICFjaGVja2JveF9rbGlrICYmICFlX2NoZWNrYm94LmNoZWNrZWQ7XG5cbiAgICAvLyBHZXQgcm93IGRhdGFcbiAgICBsZXQgW251bW1lcl9pZCwgdGl0ZWwsIGFydGllc3RdID0gdGhpcy5kYXRhdGFibGUucm93KGVfcmlqKS5kYXRhKCk7XG4gICAgbnVtbWVyX2lkID0gTnVtYmVyLnBhcnNlSW50KG51bW1lcl9pZCk7XG5cbiAgICBpZiAoIHNlbGVjdGVyZW4gKSB7XG4gICAgICAvLyBOdW1tZXIgc2VsZWN0ZXJlblxuICAgICAgaWYgKCBPYmplY3Qua2V5cyh0aGlzLmdlc2VsZWN0ZWVyZGVfbnVtbWVycykubGVuZ3RoID49IHRoaXMubWF4a2V1emVzICkge1xuICAgICAgICBlX2NoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgYWxlcnQoYFUga3VudCBtYXhpbWFhbCAke3RoaXMubWF4a2V1emVzfSBudW1tZXJzIHNlbGVjdGVyZW4uYCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICggdGhpcy5pc19hcnRpZXN0X2Vlbm1hbGlnICYmIHRoaXMuZ2VzZWxlY3RlZXJkZV9hcnRpZXN0ZW4uaW5jbHVkZXMoYXJ0aWVzdCkgKSB7XG4gICAgICAgIGVfY2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICBhbGVydCgnRGV6ZSBhcnRpZXN0IGlzIGFsIGdla296ZW4nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5nZXNlbGVjdGVlcmRlX251bW1lcnNbbnVtbWVyX2lkXSA9IG5ldyBOdW1tZXIobnVtbWVyX2lkLCB0aXRlbCwgYXJ0aWVzdCk7XG4gICAgICBpZiAoICF0aGlzLmdlc2VsZWN0ZWVyZGVfYXJ0aWVzdGVuLmluY2x1ZGVzKGFydGllc3QpICkge1xuICAgICAgICB0aGlzLmdlc2VsZWN0ZWVyZGVfYXJ0aWVzdGVuLnB1c2goYXJ0aWVzdCk7XG4gICAgICB9XG4gICAgICBlX2NoZWNrYm94LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgZV9yaWouY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTnVtbWVyIGRlc2VsZWN0ZXJlblxuICAgICAgY29uc3QgbnVtbWVyID0gdGhpcy5nZXNlbGVjdGVlcmRlX251bW1lcnNbbnVtbWVyX2lkXTtcbiAgICAgIG51bW1lci5kZXN0cm95KCk7XG4gICAgICBkZWxldGUgdGhpcy5nZXNlbGVjdGVlcmRlX251bW1lcnNbbnVtbWVyX2lkXTtcbiAgICAgIGNvbnN0IGFydGllc3RfaW5kZXggPSB0aGlzLmdlc2VsZWN0ZWVyZGVfYXJ0aWVzdGVuLmluZGV4T2YoYXJ0aWVzdCk7XG4gICAgICBpZiAoIGFydGllc3RfaW5kZXggIT09IC0xICkge1xuICAgICAgICB0aGlzLmdlc2VsZWN0ZWVyZGVfYXJ0aWVzdGVuLnNwbGljZShhcnRpZXN0X2luZGV4LCAxKTtcbiAgICAgIH1cbiAgICAgIGVfY2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgZV9yaWouY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKTtcbiAgICB9XG4gICAgaWYgKCBPYmplY3Qua2V5cyh0aGlzLmdlc2VsZWN0ZWVyZGVfbnVtbWVycykubGVuZ3RoID4gMCApIHtcbiAgICAgIHRoaXMuZV9ib2R5LmNsYXNzTGlzdC5hZGQoJ2hlZWZ0LW51bW1lcnMtZ2VzZWxlY3RlZXJkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZV9ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2hlZWZ0LW51bW1lcnMtZ2VzZWxlY3RlZXJkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZvZWd0IGVlbiB2ZWxkIG1ldCB0aXRlbCBlbiBhcnRpZXN0IHZvb3IgZWVuIG9wdGlvbmVsZSB2cmlqZSBrZXV6ZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IG51bW1lciBWb2xnbnVtbWVyIHZhbiBkZSB2cmlqZSBrZXV6ZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHRvdGFhbCBUb3RhYWwgYWFudGFsIHZyaWplIGtldXplcy5cbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIHZyaWprZXV6ZV90b2V2b2VnZW4obnVtbWVyLCB0b3RhYWwpIHtcbiAgICBjb25zdCBsYWJlbCA9IHRvdGFhbCA9PT0gMSA/ICdWcmlqZSBrZXV6ZScgOiBgVnJpamUga2V1emUgJHtudW1tZXIgKyAxfWA7XG5cbiAgICBjb25zdCBlX2FydGllc3RfY29sID0gdGhpcy52cmlqa2V1emVfdG9ldm9lZ2VuX3ZlbGQoJ0FydGllc3QnLCBudW1tZXIsIDMsIDEyOCk7XG4gICAgY29uc3QgZV90aXRlbF9jb2wgPSB0aGlzLnZyaWprZXV6ZV90b2V2b2VnZW5fdmVsZCgnVGl0ZWwnLCBudW1tZXIsIDMsIDEyOCk7XG4gICAgY29uc3QgZV90b2VsaWNodGluZ19jb2wgPSB0aGlzLnZyaWprZXV6ZV90b2V2b2VnZW5fdmVsZCgnVG9lbGljaHRpbmcnLCBudW1tZXIsIDQsIDUxMik7XG5cbiAgICBjb25zdCBlX2Zvcm1fZ3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBlX2Zvcm1fZ3JvdXAuY2xhc3NMaXN0LmFkZCgnZm9ybS1ncm91cCcsICdyb3cnKTtcblxuICAgIGNvbnN0IGVfbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGVfZm9ybV9ncm91cC5hcHBlbmRDaGlsZChlX2xhYmVsKTtcbiAgICBlX2xhYmVsLmNsYXNzTGlzdC5hZGQoJ2NvbnRyb2wtbGFiZWwnLCAnY29sLXNtLTInKTtcbiAgICBlX2xhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgZV9hcnRpZXN0X2NvbC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpLmlkKTtcbiAgICBlX2xhYmVsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxhYmVsKSk7XG5cbiAgICBlX2Zvcm1fZ3JvdXAuYXBwZW5kQ2hpbGQoZV9hcnRpZXN0X2NvbCk7XG4gICAgZV9mb3JtX2dyb3VwLmFwcGVuZENoaWxkKGVfdGl0ZWxfY29sKTtcbiAgICBlX2Zvcm1fZ3JvdXAuYXBwZW5kQ2hpbGQoZV90b2VsaWNodGluZ19jb2wpO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvcm11bGllci12ZWxkZW4nKS5hcHBlbmRDaGlsZChlX2Zvcm1fZ3JvdXApO1xuICB9XG5cbiAgLyoqXG4gICAqIFRpdGVsLSBvZiBhcnRpZXN0dmVsZCBtYWtlbi5cbiAgICogQHBhcmFtIHsnVGl0ZWwnIHwgJ0FydGllc3QnIHwgJ1RvZWxpY2h0aW5nJ30gdmVsZCBcbiAgICogQHBhcmFtIHtudW1iZXJ9IG51bW1lciBWb2xnbnVtbWVyIHZhbiBkZSB2cmlqZSBrZXV6ZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGJyZWVkdGUgQnJlZWR0ZSB2YW4gZGUga29sb20uXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXhfbGVuZ3RoXG4gICAqIEByZXR1cm5zIHtIVE1MRGl2RWxlbWVudH0gS29sb21lbGVtZW50LlxuICAgKi9cbiAgdnJpamtldXplX3RvZXZvZWdlbl92ZWxkKHZlbGQsIG51bW1lciwgYnJlZWR0ZSwgbWF4X2xlbmd0aCkge1xuICAgIGNvbnN0IHZlbGRfaW50ZXJuID0gdmVsZC50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGlkX3N0ciA9IGB2cmlqZWtldXplLSR7dmVsZF9pbnRlcm59LSR7bnVtbWVyfWA7XG4gICAgY29uc3QgbmFhbSA9IGB2cmlqZWtldXplc1ske251bW1lcn1dWyR7dmVsZF9pbnRlcm59XWA7XG5cbiAgICBjb25zdCBlX2NvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGVfY29sLmNsYXNzTGlzdC5hZGQoYGNvbC1zbS0ke2JyZWVkdGV9YCk7XG5cbiAgICBjb25zdCBlX2lucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBlX2lucHV0LnR5cGUgPSAndGV4dCc7XG4gICAgZV9jb2wuYXBwZW5kQ2hpbGQoZV9pbnB1dCk7XG4gICAgZV9pbnB1dC5jbGFzc0xpc3QuYWRkKCdmb3JtLWNvbnRyb2wnKTtcbiAgICBlX2lucHV0LmlkID0gaWRfc3RyO1xuICAgIGVfaW5wdXQubmFtZSA9IG5hYW07XG4gICAgZV9pbnB1dC5tYXhMZW5ndGggPSBtYXhfbGVuZ3RoO1xuICAgIGVfaW5wdXQucGxhY2Vob2xkZXIgPSB2ZWxkO1xuICAgIHJldHVybiBlX2NvbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQbGFhdHN0IGVlbiBmb3V0bWVsZGluZyBvcCBkZSBwYWdpbmEuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtc2cgXG4gICAqL1xuICBlcnJvcihtc2cpIHtcbiAgICB0aGlzLmVfZXJyb3Jtc2cuaW5uZXJUZXh0ID0gbXNnO1xuICAgIHRoaXMuZV9ib2R5LmNsYXNzTGlzdC5hZGQoJ2Vycm9yJyk7XG4gIH1cbn1cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgbmV3IFN0ZW1WaWV3KCk7XG59KTtcbiJdLCJuYW1lcyI6WyJhc3luYyIsInZ1bF9kYXRhdGFibGVzIiwiZGF0YSIsImNhbGxiYWNrIiwic2V0dGluZ3MiLCJzZXJ2ZXIiLCJnZXRfaHRtbF90ZW1wbGF0ZSIsImdlaW1wb3J0ZWVyZF90ZW1wbGF0ZSIsInRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidHJpbSIsImNvbnRlbnQiLCJjaGlsZHJlbiIsImZvcm1hdF90ZWxlZm9vbm51bW1lciIsInRlbGVmb29ubnVtbWVyIiwicGF0cm9uZW4iLCJwYXRyb29uIiwibSIsIm1hdGNoIiwibGVuZ3RoIiwic2hpZnQiLCJqb2luIiwiZ2V0X3JhbmRvbV9zdHJpbmciLCJsZW5ndGUiLCJyZXNwb25zIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwicG9zdCIsImZ1bmN0aWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwic2VuZF9kYXRhIiwib3BlbiIsIm9ubG9hZCIsInBvc3RfdmVyd2Vya19yZXNwb25zIiwiYmluZCIsInVuZGVmaW5lZCIsIm9uZXJyb3IiLCJGb3JtRGF0YSIsImFwcGVuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2VuZCIsImV2ZW50IiwicGFyc2UiLCJyZXNwb25zZSIsImVycm9yIiwiRXJyb3IiLCJlcnJvcmRhdGEiLCJyZXNwb25zZVRleHQiLCJOdW1tZXIiLCJlX3RyIiwiY29uc3RydWN0b3IiLCJudW1tZXJfaWQiLCJ0aXRlbCIsImFydGllc3QiLCJ0aGlzIiwiZV90ZF90aXRlbCIsImFwcGVuZENoaWxkIiwiY3JlYXRlVGV4dE5vZGUiLCJlX3RkX2FydGllc3QiLCJlX3RkX3RvZWxpY2h0aW5nIiwiY2xhc3NMaXN0IiwiYWRkIiwiZV90b2VsaWNodGluZyIsInR5cGUiLCJtYXhMZW5ndGgiLCJuYW1lIiwiZV9oaWRkZW4iLCJ2YWx1ZSIsInF1ZXJ5U2VsZWN0b3IiLCJkZXN0cm95IiwicmVtb3ZlIiwiSW52b2VydmVsZCIsImVfZm9ybV9ncm91cCIsIl9yZWYiLCJpZCIsImxhYmVsIiwibGVlZ19mZWVkYmFjayIsIm1heCIsIm1heGxlbmd0aCIsIm1pbiIsIm1pbmxlbmd0aCIsInBsYWNlaG9sZGVyIiwidmVycGxpY2h0IiwiaWRfc3RyIiwibmFhbSIsImVfbGFiZWwiLCJzZXRBdHRyaWJ1dGUiLCJlX2NvbCIsImVfaW5wdXQiLCJyb3dzIiwiaXNJbnRlZ2VyIiwibWluTGVuZ3RoIiwicmVxdWlyZWQiLCJnZXRFbGVtZW50QnlJZCIsIlN0ZW1WaWV3IiwibGlqc3RfaWQiLCJtaW5rZXV6ZXMiLCJtYXhrZXV6ZXMiLCJpc19hcnRpZXN0X2Vlbm1hbGlnIiwiaGVlZnRfcmVjYXB0Y2hhIiwiZ2VzZWxlY3RlZXJkZV9udW1tZXJzIiwiZ2VzZWxlY3RlZXJkZV9hcnRpZXN0ZW4iLCJlX2RhdGF0YWJsZSIsImVfZGF0YXRhYmxlX2JvZHkiLCJkYXRhdGFibGUiLCJlX2JvZHkiLCJlX2tldXplZm9ybXVsaWVyIiwiZV9zdGVtbWVyZm9ybXVsaWVyIiwic2VydmVyZGF0YV9wcm9taXNlIiwiZV9lcnJvcm1zZyIsInJhbmRvbV9zZWVkIiwiVVJMU2VhcmNoUGFyYW1zIiwid2luZG93IiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsIml0ZW0iLCJpbml0IiwidnVsX3NlcnZlcmRhdGEiLCJEYXRhVGFibGUiLCJwcm9jZXNzaW5nIiwic2VydmVyU2lkZSIsImFqYXgiLCJsaWpzdCIsImlzX3ZyaWpla2V1emUiLCJmdW5jdGllcyIsImJMZW5ndGhDaGFuZ2UiLCJpRGlzcGxheUxlbmd0aCIsImNvbHVtbkRlZnMiLCJ0YXJnZXRzIiwic2VhcmNoYWJsZSIsIm9yZGVyYWJsZSIsImNsYXNzTmFtZSIsInJlbmRlciIsImZ1bGwiLCJtZXRhIiwib3JkZXIiLCJvcmRlcmluZyIsImlzX3JhbmRvbV92b2xnb3JkZSIsImxhbmd1YWdlIiwibGVuZ3RoTWVudSIsInplcm9SZWNvcmRzIiwiaW5mbyIsImluZm9FbXB0eSIsImluZm9GaWx0ZXJlZCIsInBhZ2luYXRlIiwiZmlyc3QiLCJsYXN0IiwibmV4dCIsInByZXZpb3VzIiwiZWxlbSIsImVsZW1lbnRzIiwiYWRkX3RyaW1faGFuZGxlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0YWJlbF9rbGlrX2hhbmRsZXIiLCJzdWJtaXRfaGFuZGxlciIsInNlcnZlcmRhdGEiLCJnZXRfc2VydmVyZGF0YSIsIm1zZyIsIm9yZ2FuaXNhdGllIiwibGlqc3RfbmFhbSIsImlubmVyVGV4dCIsImhlZWZ0X2dlYnJ1aWtfcmVjYXB0Y2hhIiwiaXNfYWN0aWVmIiwidmVsZGRhdGEiLCJ2ZWxkZW4iLCJpIiwidnJpamVrZXV6ZXMiLCJ2cmlqa2V1emVfdG9ldm9lZ2VuIiwiZV9jYXB0Y2hhIiwicXVlcnlTZWxlY3RvckFsbCIsInJlY2FwdGNoYV9zaXRla2V5IiwiZV9zY3JpcHQiLCJzcmMiLCJwYXJlbnRFbGVtZW50IiwiZV9vcmdhbmlzYXRpZSIsImVfcHJpdmFjeV91cmwiLCJwcml2YWN5X3VybCIsInJhbmRvbV92b2xnb3JkZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiT2JqZWN0Iiwia2V5cyIsImFsZXJ0IiwidmVsZCIsImdldEF0dHJpYnV0ZSIsImZvY3VzIiwidmFsdWVBc051bWJlciIsIm1pbkxlbmdodCIsImZkIiwiaG9vZ3RlIiwib2Zmc2V0SGVpZ2h0Iiwic3R5bGUiLCJoZWlnaHQiLCJIVE1MSW5wdXRFbGVtZW50IiwiaW5jbHVkZXMiLCJIVE1MVGV4dEFyZWFFbGVtZW50IiwiZSIsInRhcmdldCIsImVfcmlqIiwiY2xvc2VzdCIsImVfY2hlY2tib3giLCJjaGVja2JveF9rbGlrIiwic2VsZWN0ZXJlbiIsImNoZWNrZWQiLCJyb3ciLCJwYXJzZUludCIsInB1c2giLCJhcnRpZXN0X2luZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsIm51bW1lciIsInRvdGFhbCIsImVfYXJ0aWVzdF9jb2wiLCJ2cmlqa2V1emVfdG9ldm9lZ2VuX3ZlbGQiLCJlX3RpdGVsX2NvbCIsImVfdG9lbGljaHRpbmdfY29sIiwiYnJlZWR0ZSIsIm1heF9sZW5ndGgiLCJ2ZWxkX2ludGVybiIsInRvTG93ZXJDYXNlIl0sInNvdXJjZVJvb3QiOiIifQ==