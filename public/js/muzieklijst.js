"use strict";(self.webpackChunkmuzieklijsten=self.webpackChunkmuzieklijsten||[]).push([[546],{926:function(e,t,r){r.d(t,{Df:function(){return o},Jc:function(){return a},am:function(){return i},em:function(){return s}});var n=r(936);async function s(e,t,r){t(await n.b("vul_datatables",e))}function i(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children}function a(e){const t=[/^(\+31)((?:11|16|17|18|22|25|29|31|32|34|41|44|47|47|48|49|51|52|54|56|57|59|67|80|90)[0-9])([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)(6)([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)([0-9]{2})([0-9]{3})([0-9]{2})([0-9]{2})$/];for(const r of t){let t=e.match(r);if(null!==t&&t.length>0)return t.shift(),t.join(" ")}return e}function o(e){let t="";for(;t.length<e;)t+=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(36);return t.substring(0,e)}},936:function(e,t,r){function n(e,t){return new Promise(((r,n)=>{const i=new XMLHttpRequest;let a;i.open("POST","ajax.php",!0),i.onload=s.bind(void 0,i,r,n),i.onerror=s.bind(void 0,i,r,n),t instanceof FormData?(t.append("functie",e),a=t):(a=JSON.stringify({functie:e,...t}),i.setRequestHeader("Content-Type","application/json")),i.send(a)}))}function s(e,t,r,n){try{const n=JSON.parse(e.response);!1!==n.error?r(new Error(n.errordata)):t(n.data)}catch(t){r(new Error(e.responseText))}}r.d(t,{b:function(){return n}})},172:function(e,t,r){r(125);var n=r(601),s=r(936),i=r(926);class a{e_tr;constructor(e,t,r){this.e_tr=document.createElement("tr");const n=document.createElement("td");n.appendChild(document.createTextNode(t)),this.e_tr.appendChild(n);const s=document.createElement("td");s.appendChild(document.createTextNode(r)),this.e_tr.appendChild(s);const i=document.createElement("td");i.classList.add("remark"),this.e_tr.appendChild(i);const a=document.createElement("input");a.type="text",a.classList.add("form-control"),a.maxLength=1024,a.name=`nummers[${e}][toelichting]`,i.appendChild(a);const o=document.createElement("input");o.type="hidden",o.name=`nummers[${e}][id]`,o.value=e,this.e_tr.appendChild(o),document.querySelector("#keuzes tbody").appendChild(this.e_tr)}destroy(){this.e_tr.remove()}}class o{e_form_group;constructor(e){let{id:t,label:r,leeg_feedback:n,max:s,maxlength:i,min:a,minlength:o,placeholder:d,type:l,verplicht:m}=e;const c=`veld-${t}`,u=`velden[${t}]`;this.e_form_group=document.createElement("div"),this.e_form_group.classList.add("form-group","row");const h=document.createElement("label");this.e_form_group.appendChild(h),h.classList.add("control-label","col-sm-2"),h.setAttribute("for",c),h.appendChild(document.createTextNode(r));const _=document.createElement("div");let g;this.e_form_group.appendChild(_),_.classList.add("col-sm-10"),"textarea"===l?(g=document.createElement("textarea"),g.rows=5):(g=document.createElement("input"),"postcode"===l?(g.type="text",g.classList.add("postcode")):g.type=l,Number.isInteger(s)&&(g.max=s),Number.isInteger(a)&&(g.min=a)),_.appendChild(g),g.classList.add("form-control"),g.id=c,g.name=u,g.setAttribute("data-leeg-feedback",n),Number.isInteger(i)&&(g.maxLength=i),Number.isInteger(o)&&(g.minLength=o),"string"==typeof d&&(g.placeholder=d),g.required=m,document.getElementById("formulier-velden").appendChild(this.e_form_group)}}class d{lijst_id;minkeuzes;maxkeuzes;is_artiest_eenmalig;heeft_recaptcha;geselecteerde_nummers;geselecteerde_artiesten;e_datatable;e_datatable_body;datatable;e_body;e_keuzeformulier;e_stemmerformulier;serverdata_promise;e_errormsg;random_seed;constructor(){this.lijst_id=new URLSearchParams(window.location.search).get("lijst"),this.e_body=document.getElementsByTagName("body").item(0),this.e_keuzeformulier=document.getElementById("keuzeformulier"),this.e_stemmerformulier=document.getElementById("stemmerformulier"),this.geselecteerde_nummers={},this.geselecteerde_artiesten=[],this.e_errormsg=document.getElementById("errormsg"),this.random_seed=Math.floor(65536*Math.random()),this.init()}async init(){await this.vul_serverdata(),this.e_body.classList.add("geladen");const e=document.getElementById("nummers");this.datatable=new n.A(e,{processing:!0,serverSide:!0,ajax:(e,t,r)=>{e.lijst=this.lijst_id,e.is_vrijekeuze=!1,e.random_seed=this.random_seed,i.em(e,t,r)},bLengthChange:!1,iDisplayLength:50,columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:(e,t,r,n)=>'<input type="checkbox">'}],order:[[1,"asc"],[2,"asc"]],ordering:!await this.is_random_volgorde(),language:{lengthMenu:"_MENU_ nummers per pagina",zeroRecords:"Geen nummers gevonden",info:"Pagina _PAGE_ van _PAGES_",infoEmpty:"Geen nummers gevonden",infoFiltered:"(gefilterd van _MAX_ totaal)",search:"Zoeken:",paginate:{first:"Eerste",last:"Laatste",next:"Volgende",previous:"Vorige"}}}),this.e_datatable_body=e.getElementsByTagName("tbody").item(0);for(const e of this.e_stemmerformulier.elements)this.add_trim_handler(e);this.e_datatable_body.addEventListener("click",this.tabel_klik_handler.bind(this)),this.e_keuzeformulier.addEventListener("submit",this.submit_handler.bind(this)),this.e_stemmerformulier.addEventListener("submit",this.submit_handler.bind(this))}async vul_serverdata(){let e;try{e=await this.get_serverdata()}catch(e){return void this.error(e)}this.minkeuzes=e.minkeuzes,this.maxkeuzes=e.maxkeuzes,this.is_artiest_eenmalig=e.is_artiest_eenmalig;const t=`${e.organisatie} – ${e.lijst_naam}`;document.getElementsByTagName("title").item(0).innerText=t,e.heeft_gebruik_recaptcha&&this.e_body.classList.add("heeft-recaptcha"),e.is_actief&&this.e_body.classList.add("is-actief"),this.e_keuzeformulier.elements.lijst.value=this.lijst_id;for(const t of e.velden)new o(t);for(let t=0;t<e.vrijekeuzes;t++)this.vrijkeuze_toevoegen(t,e.vrijekeuzes);for(const t of document.querySelectorAll(".g-recaptcha")){t.setAttribute("data-sitekey",e.recaptcha_sitekey);const r=document.createElement("script");r.src="https://www.google.com/recaptcha/api.js?hl=nl",t.parentElement.appendChild(r)}for(const t of document.querySelectorAll(".organisatie"))t.innerText=e.organisatie;for(const t of document.querySelectorAll("a.privacy-url"))t.setAttribute("href",e.privacy_url)}get_serverdata(){return this.serverdata_promise??=s.b("get_stemlijst_frontend_data",{lijst:this.lijst_id})}async is_random_volgorde(){return(await this.get_serverdata()).random_volgorde}async submit_handler(e){if(e.preventDefault(),e.stopPropagation(),Object.keys(this.geselecteerde_nummers).length<this.minkeuzes)return void alert(`U moet mimimaal ${this.minkeuzes} nummers selecteren.`);if(this.heeft_recaptcha&&""===document.getElementById("g-recaptcha-response").value)return void alert("Plaats een vinkje a.u.b.");for(const e of this.e_stemmerformulier.elements){if(e.required&&""===e.value)return alert(e.getAttribute("data-leeg-feedback")),void e.focus();if(e.min>0&&e.valueAsNumber<e.min)return void alert(`De waarde van ${e.name} is te laag. Het minimum is ${e.min}`);if(e.max>0&&e.valueAsNumber>e.max)return void alert(`De waarde van ${e.name} is te hoog. Het maximum is ${e.max}`);if(e.minLength>0&&e.value.length<e.minLength)return void alert(`De invoer van ${e.name} is te kort. De minimumlengte is ${e.minLenght}`);if(e.maxLength>0&&e.value.length>e.maxLength)return void alert(`De invoer van ${e.name} is te lang. De maximumlengte is ${e.maxLength}`)}const t=new FormData(this.e_stemmerformulier);t.append("lijst",this.lijst_id);try{const e=await s.b("stem",t),r=document.getElementById("stemsegment").offsetHeight-100;document.getElementById("stemsegment-placeholder").style.height=`${r}px`,document.getElementById("result").innerHTML=e,this.e_body.classList.add("gestemd")}catch(e){alert(e)}}add_trim_handler(e){(e instanceof HTMLInputElement&&["email","month","number","tel","text","time","url","week"].includes(e.type)||e instanceof HTMLTextAreaElement)&&e.addEventListener("blur",(e=>{e.target.value=e.target.value.trim()}))}tabel_klik_handler(e){const t=e.target.closest("tr"),r=t.querySelector('input[type="checkbox"]'),n=e.target instanceof HTMLInputElement,s=n&&r.checked||!n&&!r.checked;let[i,o,d]=this.datatable.row(t).data();if(i=Number.parseInt(i),s){if(Object.keys(this.geselecteerde_nummers).length>=this.maxkeuzes)return r.checked=!1,void alert(`U kunt maximaal ${this.maxkeuzes} nummers selecteren.`);if(this.is_artiest_eenmalig&&this.geselecteerde_artiesten.includes(d))return r.checked=!1,void alert("Deze artiest is al gekozen");this.geselecteerde_nummers[i]=new a(i,o,d),this.geselecteerde_artiesten.includes(d)||this.geselecteerde_artiesten.push(d),r.checked=!0,t.classList.add("selected")}else{this.geselecteerde_nummers[i].destroy(),delete this.geselecteerde_nummers[i];const e=this.geselecteerde_artiesten.indexOf(d);-1!==e&&this.geselecteerde_artiesten.splice(e,1),r.checked=!1,t.classList.remove("selected")}Object.keys(this.geselecteerde_nummers).length>0?this.e_body.classList.add("heeft-nummers-geselecteerd"):this.e_body.classList.remove("heeft-nummers-geselecteerd")}vrijkeuze_toevoegen(e,t){const r=1===t?"Vrije keuze":`Vrije keuze ${e+1}`,n=this.vrijkeuze_toevoegen_veld("Artiest",e,3,128),s=this.vrijkeuze_toevoegen_veld("Titel",e,3,128),i=this.vrijkeuze_toevoegen_veld("Toelichting",e,4,512),a=document.createElement("div");a.classList.add("form-group","row");const o=document.createElement("label");a.appendChild(o),o.classList.add("control-label","col-sm-2"),o.setAttribute("for",n.querySelector("input").id),o.appendChild(document.createTextNode(r)),a.appendChild(n),a.appendChild(s),a.appendChild(i),document.getElementById("formulier-velden").appendChild(a)}vrijkeuze_toevoegen_veld(e,t,r,n){const s=e.toLowerCase(),i=`vrijekeuze-${s}-${t}`,a=`vrijekeuzes[${t}][${s}]`,o=document.createElement("div");o.classList.add(`col-sm-${r}`);const d=document.createElement("input");return d.type="text",o.appendChild(d),d.classList.add("form-control"),d.id=i,d.name=a,d.maxLength=n,d.placeholder=e,o}error(e){this.e_errormsg.innerText=e,this.e_body.classList.add("error")}}document.addEventListener("DOMContentLoaded",(()=>{new d}))}},function(e){e.O(0,[778,408],(function(){return t=172,e(e.s=t);var t}));e.O()}]);