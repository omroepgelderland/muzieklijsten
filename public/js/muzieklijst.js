"use strict";(self.webpackChunkmuzieklijsten=self.webpackChunkmuzieklijsten||[]).push([[546],{784:function(e,t,n){function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,r)=>{let s=new XMLHttpRequest;s.open("POST","ajax.php",!0),s.onload=i.bind(void 0,s,n,r),s.onerror=i.bind(void 0,s,n,r),t instanceof FormData?t.append("functie",e):(s.setRequestHeader("Content-Type","application/json"),t.functie=e,t=JSON.stringify(t)),s.send(t)}))}function i(e,t,n,r){try{let r=JSON.parse(e.response);!1!==r.error?n(r.errordata):t(r.data)}catch(t){n(e.responseText)}}function s(e){return r("verwijder_lijst",{lijst:e})}function a(e){return r("lijst_opslaan",e)}function o(e){return r("lijst_maken",e)}function l(e,t){return r("losse_nummers_toevoegen",{nummers:e,lijsten:t})}function d(){return r("get_lijsten",{})}function m(e,t,n,i){return r("stem_set_behandeld",{nummer:e,lijst:t,stemmer:n,waarde:i})}function u(e,t,n){return r("verwijder_stem",{nummer:e,lijst:t,stemmer:n})}function c(e,t,n){return r("get_totaal_aantal_stemmers",{lijst:e,van:t,tot:n})}function h(e){return r("stem",e)}function _(e){return r("get_geselecteerde_nummers",{lijst:e})}async function g(e,t,n){t(await r("vul_datatables",e))}function f(){return r("login",{})}function p(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children}function v(e,t,n){void 0!==n?e.dispatchEvent(new CustomEvent(t,{detail:n})):e.dispatchEvent(new CustomEvent(t))}function b(e){const t=[/^(\+31)((?:11|16|17|18|22|25|29|31|32|34|41|44|47|47|48|49|51|52|54|56|57|59|67|80|90)[0-9])([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)(6)([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)([0-9]{2})([0-9]{3})([0-9]{2})([0-9]{2})$/];for(const n of t){let t=e.match(n);if(null!==t&&t.length>0)return t.shift(),t.join(" ")}return e}function k(e){let t="";for(;t.length<e;)t+=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(36);return t.substring(0,e)}n.d(t,{$y:function(){return m},Df:function(){return k},Jc:function(){return b},WS:function(){return h},YL:function(){return o},am:function(){return p},bE:function(){return r},bK:function(){return d},cO:function(){return c},em:function(){return g},hZ:function(){return v},iD:function(){return f},jD:function(){return _},kN:function(){return l},q6:function(){return s},yc:function(){return a},z9:function(){return u}})},196:function(e,t,n){n(125),n(258);var r=n(784),i=n(692);class s{e_tr;constructor(e,t,n){this.e_tr=document.createElement("tr");let r=document.createElement("td");r.appendChild(document.createTextNode(t)),this.e_tr.appendChild(r);let i=document.createElement("td");i.appendChild(document.createTextNode(n)),this.e_tr.appendChild(i);let s=document.createElement("td");s.classList.add("remark"),this.e_tr.appendChild(s);let a=document.createElement("input");a.type="text",a.classList.add("form-control"),a.maxLength=1024,a.name=`nummers[${e}][toelichting]`,s.appendChild(a);let o=document.createElement("input");o.type="hidden",o.name=`nummers[${e}][id]`,o.value=e,this.e_tr.appendChild(o),document.querySelector("#keuzes tbody").appendChild(this.e_tr)}destroy(){this.e_tr.parentNode.removeChild(this.e_tr)}}class a{e_form_group;constructor(e){let{id:t,label:n,leeg_feedback:r,max:i,maxlength:s,min:a,minlength:o,placeholder:l,type:d,verplicht:m}=e;const u=`veld-${t}`,c=`velden[${t}]`;this.e_form_group=document.createElement("div"),this.e_form_group.classList.add("form-group","row");let h=document.createElement("label");this.e_form_group.appendChild(h),h.classList.add("control-label","col-sm-2"),h.setAttribute("for",u),h.appendChild(document.createTextNode(n));let _,g=document.createElement("div");this.e_form_group.appendChild(g),g.classList.add("col-sm-10"),"textarea"===d?(_=document.createElement("textarea"),_.rows=5):(_=document.createElement("input"),"postcode"===d?(_.type="text",_.classList.add("postcode")):_.type=d,Number.isInteger(i)&&(_.max=i),Number.isInteger(a)&&(_.min=a)),g.appendChild(_),_.classList.add("form-control"),_.id=u,_.name=c,_.setAttribute("data-leeg-feedback",r),Number.isInteger(s)&&(_.maxLength=s),Number.isInteger(o)&&(_.minLength=o),"string"==typeof l&&(_.placeholder=l),_.required=m,document.getElementById("formulier-velden").appendChild(this.e_form_group)}}class o{lijst_id;minkeuzes;maxkeuzes;is_artiest_eenmalig;heeft_recaptcha;geselecteerde_nummers;geselecteerde_artiesten;e_datatable;e_datatable_body;datatable;e_body;e_keuzeformulier;e_stemmerformulier;serverdata_promise;e_errormsg;random_seed;constructor(){this.lijst_id=new URLSearchParams(window.location.search).get("lijst"),this.e_body=document.getElementsByTagName("body").item(0),this.e_keuzeformulier=document.getElementById("keuzeformulier"),this.e_stemmerformulier=document.getElementById("stemmerformulier"),this.geselecteerde_nummers={},this.geselecteerde_artiesten=[],this.e_errormsg=document.getElementById("errormsg"),this.random_seed=Math.floor(65536*Math.random()),this.init()}async init(){await this.vul_serverdata(),this.e_body.classList.add("geladen");const e=document.getElementById("nummers");this.datatable=i(e).DataTable({processing:!0,serverSide:!0,ajax:(e,t,n)=>{e.lijst=this.lijst_id,e.is_vrijekeuze=!1,e.random_seed=this.random_seed,r.em(e,t,n)},bLengthChange:!1,iDisplayLength:50,columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:(e,t,n,r)=>'<input type="checkbox">'}],order:[[2,"asc"],[1,"asc"]],ordering:!await this.is_random_volgorde(),language:{lengthMenu:"_MENU_ nummers per pagina",zeroRecords:"Geen nummers gevonden",info:"Pagina _PAGE_ van _PAGES_",infoEmpty:"Geen nummers gevonden",infoFiltered:"(gefilterd van _MAX_ totaal)",search:"Zoeken:",paginate:{first:"Eerste",last:"Laatste",next:"Volgende",previous:"Vorige"}}}),this.e_datatable_body=e.getElementsByTagName("tbody").item(0);for(const e of this.e_stemmerformulier.elements)this.add_trim_handler(e);this.e_datatable_body.addEventListener("click",this.tabel_klik_handler.bind(this)),this.e_keuzeformulier.addEventListener("submit",this.submit_handler.bind(this)),this.e_stemmerformulier.addEventListener("submit",this.submit_handler.bind(this))}async vul_serverdata(){let e;try{e=await this.get_serverdata()}catch(e){return void this.error(e)}this.minkeuzes=e.minkeuzes,this.maxkeuzes=e.maxkeuzes,this.is_artiest_eenmalig=e.is_artiest_eenmalig;const t=`${e.organisatie} – ${e.lijst_naam}`;document.getElementsByTagName("title").item(0).innerText=t,e.heeft_gebruik_recaptcha&&this.e_body.classList.add("heeft-recaptcha"),e.is_actief&&this.e_body.classList.add("is-actief"),e.is_max_stemmen_per_ip_bereikt&&this.e_body.classList.add("max-ip-bereikt"),this.e_keuzeformulier.elements.lijst.value=this.lijst_id;for(const t of e.velden)new a(t);for(let t=0;t<e.vrijekeuzes;t++)this.vrijkeuze_toevoegen(t,e.vrijekeuzes);for(const t of document.querySelectorAll(".g-recaptcha")){t.setAttribute("data-sitekey",e.recaptcha_sitekey);let n=document.createElement("script");n.src="https://www.google.com/recaptcha/api.js?hl=nl",t.parentElement.appendChild(n)}for(const t of document.querySelectorAll(".organisatie"))t.innerText=e.organisatie;for(const t of document.querySelectorAll("a.privacy-url"))t.setAttribute("href",e.privacy_url)}get_serverdata(){return this.serverdata_promise??=r.bE("get_stemlijst_frontend_data",{lijst:this.lijst_id})}async is_random_volgorde(){return(await this.get_serverdata()).random_volgorde}submit_handler(e){if(e.preventDefault(),e.stopPropagation(),Object.keys(this.geselecteerde_nummers).length<this.minkeuzes)return void alert(`U moet mimimaal ${this.minkeuzes} nummers selecteren.`);if(this.heeft_recaptcha&&""===document.getElementById("g-recaptcha-response").value)return void alert("Plaats een vinkje a.u.b.");for(const e of this.e_stemmerformulier.elements){if(e.required&&""===e.value)return alert(e.getAttribute("data-leeg-feedback")),void e.focus();if(e.min>0&&e.valueAsNumber<e.min)return void alert(`De waarde van ${e.name} is te laag. Het minimum is ${e.min}`);if(e.max>0&&e.valueAsNumber>e.max)return void alert(`De waarde van ${e.name} is te hoog. Het maximum is ${e.max}`);if(e.minLength>0&&e.value.length<e.minLength)return void alert(`De invoer van ${e.name} is te kort. De minimumlengte is ${e.minLenght}`);if(e.maxLength>0&&e.value.length>e.maxLength)return void alert(`De invoer van ${e.name} is te lang. De maximumlengte is ${e.maxLength}`)}let t=new FormData(this.e_stemmerformulier);t.append("lijst",this.lijst_id),r.WS(t).then((e=>{let t=document.getElementById("stemsegment").offsetHeight-100;document.getElementById("stemsegment-placeholder").style.height=`${t}px`,document.getElementById("result").innerHTML=e,this.e_body.classList.add("gestemd")}),(e=>{alert(e)}))}add_trim_handler(e){(e instanceof HTMLInputElement&&["email","month","number","tel","text","time","url","week"].includes(e.type)||e instanceof HTMLTextAreaElement)&&e.addEventListener("blur",(e=>{e.target.value=e.target.value.trim()}))}tabel_klik_handler(e){const t=e.target.closest("tr"),n=t.querySelector('input[type="checkbox"]'),r=e.target instanceof HTMLInputElement,a=r&&n.checked||!r&&!n.checked;let o=this.datatable.row(i(t)).data(),l=o[0],d=o[1],m=o[2];if(a){if(Object.keys(this.geselecteerde_nummers).length>=this.maxkeuzes)return n.checked=!1,void alert(`U kunt maximaal ${this.maxkeuzes} nummers selecteren.`);if(this.is_artiest_eenmalig&&this.geselecteerde_artiesten.includes(m))return n.checked=!1,void alert("Deze artiest is al gekozen");this.geselecteerde_nummers[l]=new s(l,d,m),this.geselecteerde_artiesten.includes(m)||this.geselecteerde_artiesten.push(m),n.checked=!0,t.classList.add("selected")}else{this.geselecteerde_nummers[l].destroy(),delete this.geselecteerde_nummers[l];let e=this.geselecteerde_artiesten.indexOf(m);-1!==e&&this.geselecteerde_artiesten.splice(e,1),n.checked=!1,t.classList.remove("selected")}Object.keys(this.geselecteerde_nummers).length>0?this.e_body.classList.add("heeft-nummers-geselecteerd"):this.e_body.classList.remove("heeft-nummers-geselecteerd")}vrijkeuze_toevoegen(e,t){const n=1===t?"Vrije keuze":`Vrije keuze ${e+1}`,r=this.vrijkeuze_toevoegen_veld("Artiest",e,3,128),i=this.vrijkeuze_toevoegen_veld("Titel",e,3,128),s=this.vrijkeuze_toevoegen_veld("Toelichting",e,4,512),a=document.createElement("div");a.classList.add("form-group","row");const o=document.createElement("label");a.appendChild(o),o.classList.add("control-label","col-sm-2"),o.setAttribute("for",r.querySelector("input").id),o.appendChild(document.createTextNode(n)),a.appendChild(r),a.appendChild(i),a.appendChild(s),document.getElementById("formulier-velden").appendChild(a)}vrijkeuze_toevoegen_veld(e,t,n,r){const i=e.toLowerCase(),s=`vrijekeuze-${i}-${t}`,a=`vrijekeuzes[${t}][${i}]`,o=document.createElement("div");o.classList.add(`col-sm-${n}`);const l=document.createElement("input");return l.type="text",o.appendChild(l),l.classList.add("form-control"),l.id=s,l.name=a,l.maxLength=r,l.placeholder=e,o}error(e){this.e_errormsg.innerText=e,this.e_body.classList.add("error")}}document.addEventListener("DOMContentLoaded",(()=>{new o}))}},function(e){e.O(0,[778,408],(function(){return t=196,e(e.s=t);var t}));e.O()}]);