"use strict";(self.webpackChunkmuzieklijsten=self.webpackChunkmuzieklijsten||[]).push([[884],{445:function(e,t,s){s(125),s(258);var a=s(784),i=(s(692),s(692));class n{lijst_id;lijst_naam_promise;e_body;e_lijst_select;e_geselecteerd_lijst;e_aantal_geselecteerde_nummers;geselecteerde_nummers;tabel;constructor(){this.e_body=document.getElementsByTagName("body").item(0),this.e_lijst_select=document.getElementById("lijstselect"),this.e_geselecteerd_lijst=document.getElementById("geselecteerd-lijst"),this.e_aantal_geselecteerde_nummers=document.getElementById("aantal-geselecteerde-nummers"),this.lijst_naam_promise=Promise.resolve("?"),this.vul_metadata().then((()=>{let e=new URLSearchParams(document.location.search).get("lijst");for(const t of this.e_lijst_select.options)if(t.value==e){t.selected=!0,this.set_lijst(e);break}})),this.tabel=i("#beschikbare-nummers").DataTable({processing:!0,serverSide:!0,ajax:(e,t,s)=>{e.is_vrijekeuze=!1,a.em(e,t,s)},columnDefs:[{targets:0,searchable:!1,orderable:!1,className:"dt-body-center",render:(e,t,s,a)=>{let[i,n,l,r]=s,d=document.createElement("input");return d.setAttribute("type","checkbox"),d.outerHTML}}],order:[1,"asc"],rowCallback:this.toon_geselecteerd.bind(this),language:{lengthMenu:"_MENU_ nummers per pagina",zeroRecords:"Geen nummers gevonden",info:"Pagina _PAGE_ van _PAGES_",infoEmpty:"Geen nummers gevonden",infoFiltered:"(gefilterd van _MAX_ totaal)",search:"Zoeken:",paginate:{first:"Eerste",last:"Laatste",next:"Volgende",previous:"Vorige"}}}),i("#beschikbare-nummers").on("click","tbody>tr",this.checkbox_handler.bind(this)),document.getElementById("lijstselect").addEventListener("change",this.lijst_select_handler.bind(this)),document.getElementById("beheerknop").addEventListener("click",this.beheer_knop_handler.bind(this)),document.getElementById("nieuwknop").addEventListener("click",this.nieuw_knop_handler.bind(this)),document.getElementById("resultatenknop").addEventListener("click",this.resultaten_knop_handler.bind(this))}async set_lijst(e){this.lijst_id=e;let t=new URL(location.href),s=t.searchParams;s.set("lijst",this.lijst_id),t.params=s,window.history.replaceState(null,null,t),this.e_body.classList.add("lijst-geselecteerd");for(const e of document.getElementsByClassName("bewerk-knop"))e.removeAttribute("title");const a=this.vul_lijst_metadata();this.lijst_naam_promise=a.then((e=>e.naam)),await a,this.tabel.draw()}async vul_metadata(){const e=await a.bE("get_metadata");for(const t of document.getElementsByClassName("organisatie"))t.innerText=e.organisatie;for(const t of e.lijsten)this.e_lijst_select.add(new Option(t.naam,t.id));document.getElementById("totaal-aantal-nummers").innerText=e.totaal_aantal_nummers;for(const t of document.getElementsByClassName("nimbus-url"))t.href=e.nimbus_url}async vul_lijst_metadata(){const e=await a.bE("get_lijst_metadata",{lijst:this.lijst_id});for(const t of document.getElementsByClassName("lijst-naam"))t.innerText=e.naam;document.getElementsByTagName("title").item(0).innerText=`Muzieklijsten beheer – ${e.naam}`;for(const t of document.getElementsByClassName("iframe-url"))t.value=e.iframe_url;for(const t of document.getElementsByClassName("iframe-code"))t.value=`<iframe src="${e.iframe_url}" frameborder="0" height="3000" style="width: 100%; height: 3000px; border: none;">`;return this.geselecteerde_nummers=e.nummer_ids,this.vul_lijst_geselecteerde_nummers(),i("#beschikbare-nummers_length select").addClass("form-control"),i("#beschikbare-nummers_filter input").addClass("form-control"),e}checkbox_handler(e){e.preventDefault();let t,s,a,n,l=i(e.target).closest("tr"),r=l.find('input[type="checkbox"]').addBack('input[type="checkbox"]');[t,s,a,n]=this.tabel.row(l).data();let d=i.inArray(t,this.geselecteerde_nummers);return-1===d?this.nummer_toevoegen(t).then((()=>(this.geselecteerde_nummers.push(t),r.prop("checked",!0),l.addClass("selected"),this.vul_lijst_geselecteerde_nummers())),(e=>{r.prop("checked",!1),alert(e)})):this.nummer_verwijderen(t).then((()=>(this.geselecteerde_nummers.splice(d,1),r.prop("checked",!1),l.removeClass("selected"),this.vul_lijst_geselecteerde_nummers())),(e=>{r.prop("checked",!0),alert(e)}))}lijst_select_handler(e){e.target.value>0?this.set_lijst(e.target.value):this.unset_lijst()}toon_geselecteerd(e,t,s){let[a,n,l,r]=t;-1!==i.inArray(a,this.geselecteerde_nummers)&&(i(e).find('input[type="checkbox"]').prop("checked",!0),i(e).addClass("selected"))}nummer_toevoegen(e){return a.bE("lijst_nummer_toevoegen",{lijst:this.lijst_id,nummer:e})}nummer_verwijderen(e){return a.bE("lijst_nummer_verwijderen",{lijst:this.lijst_id,nummer:e})}vul_lijst_geselecteerde_nummers(){let e=a.jD(this.lijst_id);for(;this.e_geselecteerd_lijst.firstChild;)this.e_geselecteerd_lijst.removeChild(this.e_geselecteerd_lijst.firstChild);return e.then((e=>{this.e_aantal_geselecteerde_nummers.innerText=e.length;for(const t of e){let e=document.createElement("tr");this.e_geselecteerd_lijst.appendChild(e);let s=document.createElement("td");e.appendChild(s),s.appendChild(document.createTextNode(t.titel));let a=document.createElement("td");e.appendChild(a),a.appendChild(document.createTextNode(t.artiest));let i=document.createElement("td");e.appendChild(i),i.appendChild(document.createTextNode(t.jaar??""))}}))}async resultaten_knop_handler(e){e.preventDefault(),new l(this.lijst_id,await this.lijst_naam_promise)}nieuw_knop_handler(e){e.preventDefault(),(new m).eventer.addEventListener("lijst_gemaakt",this.lijst_veranderd.bind(this,!0))}beheer_knop_handler(e){e.preventDefault();let t=new m(this.lijst_id);t.eventer.addEventListener("lijst_veranderd",this.lijst_veranderd.bind(this,!1)),t.eventer.addEventListener("lijst_verwijderd",this.lijst_verwijderd.bind(this))}lijst_veranderd(e,t){if(e)this.e_lijst_select.add(new Option(t.detail.naam,t.detail.id,!1,!0)),this.set_lijst(t.detail.id);else{this.e_lijst_select.item(this.e_lijst_select.selectedIndex).text=t.detail.naam}}lijst_verwijderd(){this.e_lijst_select.remove(this.e_lijst_select.selectedIndex),this.unset_lijst()}unset_lijst(e){this.lijst_id=void 0;let t=new URL(location.href),s=t.searchParams;s.delete("lijst"),t.params=s,window.history.replaceState(null,null,t),this.e_body.classList.remove("lijst-geselecteerd"),document.getElementsByTagName("title").item(0).innerText="Muzieklijsten beheer",this.geselecteerde_nummers=[],this.vul_lijst_geselecteerde_nummers()}}class l{lijst_id;e_modal;$modal;e_totaal_aantal_stemmen;e_totaal_aantal_stemmers;e_filters_form;e_resultaten_tabel;resultaten_nummers;totaal_aantal_stemmen;constructor(e,t){this.lijst_id=e,this.resultaten_nummers=[],this.totaal_aantal_stemmen=0,this.e_modal=a.am('<div class="modal fade resultaten-modal" role="dialog"> <div class="modal-dialog"> <div class="modal-header modal-top"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> <h4 class="modal-title">Resultaten van de lijst ‘<span class="lijst-naam"></span>’</h4> </div> <div class="modal-content"> <form class="filters" autocomplete="off"> <div class="input-group"> <input type="text" name="filter-nummers" class="form-control" placeholder="Filter nummers"> </div> <div class="input-group"> <input type="text" name="filter-stemmers" class="form-control" placeholder="Filter stemmers"> </div> <div class="input-group date"> <label>van:</label> <input type="date" name="van" class="form-control"> </div> <div class="input-group date"> <label>tot:</label> <input type="date" name="tot" class="form-control"> </div> <div> <input type="submit" value="Filters toepassen" class="btn btn-default"> </div> <div> <input type="reset" value="Filters wissen" class="btn btn-default"> </div> </form> <div class="table-responsive"> <table class="table table-striped"> <thead> <tr> <th></th> <th>Titel</th> <th>Artiest</th> <th class="text-center"><span class="totaal-aantal-stemmen"></span> stemmen<br> <span class="totaal-aantal-stemmers"></span> stemmers</th> </tr> </thead> <tbody class="resultaten-tabel"></tbody> </table> </div> </div> <div class="modal-footer modal-end"> <button type="button" class="btn btn-default" data-dismiss="modal">Sluiten</button> </div> </div> </div> ').item(0),this.e_totaal_aantal_stemmen=this.e_modal.getElementsByClassName("totaal-aantal-stemmen").item(0),this.e_totaal_aantal_stemmers=this.e_modal.getElementsByClassName("totaal-aantal-stemmers").item(0),this.e_filters_form=this.e_modal.querySelector("form.filters"),this.e_filters_form.addEventListener("submit",this.filter.bind(this)),this.e_filters_form.addEventListener("reset",this.filter_reset.bind(this)),this.e_resultaten_tabel=this.e_modal.querySelector(".resultaten-tabel"),this.e_resultaten_tabel.id=a.Df(12),this.set_totaal_aantal_stemmers(),this.maak_resultaten_tabel();for(const e of this.e_modal.querySelectorAll(".lijst-naam"))e.textContent=t;document.getElementsByTagName("body").item(0).appendChild(this.e_modal),this.$modal=i(this.e_modal),this.$modal.modal({backdrop:!0,focus:!0,keyboard:!0}),this.$modal.on("hidden.bs.modal",(e=>{this.e_modal.parentNode.removeChild(this.e_modal)})),this.$modal.modal("show")}async maak_resultaten_tabel(){let e=a.bE("get_resultaten_labels",{lijst:this.lijst_id}),t=await a.bE("get_resultaten",{lijst:this.lijst_id});for(const s of t){let t=new r(this,this.e_resultaten_tabel);t.eventer.addEventListener("stem_verwijderd",this.stem_verwijderd_handler.bind(this)),t.eventer.addEventListener("verwijderd",this.nummer_verwijderd_handler.bind(this)),t.maak_velden_labels(e),t.set_nummer(s.nummer),t.maak_stemmen(s.stemmen),this.resultaten_nummers.push(t),this.add_totaal_aantal_stemmen(s.stemmen.length)}}add_totaal_aantal_stemmen(e){this.totaal_aantal_stemmen+=e,this.e_totaal_aantal_stemmen.innerText=this.totaal_aantal_stemmen}async set_totaal_aantal_stemmers(){this.e_totaal_aantal_stemmers.innerText=await a.cO(this.lijst_id)}stem_verwijderd_handler(e){this.add_totaal_aantal_stemmen(-1),this.set_totaal_aantal_stemmers()}nummer_verwijderd_handler(e){const t=e.detail;this.add_totaal_aantal_stemmen(-t),this.set_totaal_aantal_stemmers()}filter(e){e.preventDefault();let t=this.e_filters_form.elements["filter-nummers"].value.toLowerCase(),s=this.e_filters_form.elements["filter-stemmers"].value.toLowerCase();t.length<3&&(t="",this.e_filters_form.elements["filter-nummers"].value=""),s.length<3&&(s="",this.e_filters_form.elements["filter-stemmers"].value="");let a=new Date(this.e_filters_form.elements.van.value),i=new Date(this.e_filters_form.elements.tot.value);isNaN(a)?a=null:(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),isNaN(i)?i=null:(i.setDate(i.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0));for(const e of this.resultaten_nummers)e.filter(t,s,a,i)}filter_reset(e){for(const e of this.e_filters_form.elements)"text"!==e.type&&"date"!==e.type||(e.value="");this.filter(e)}}class r{resultaten_modal;e_container;eventer;resultaten_stemmen;e_tr_uitklap;e_tr_gegevens;e_aantal_stemmen;nummer_id;titel;artiest;constructor(e,t){this.resultaten_modal=e,this.e_container=t,this.eventer=document.createElement(null),this.resultaten_stemmen=[];const s=a.am('<tr data-toggle="collapse" class="nummer hand collapsed" aria-expanded="false"> <td class="text-center"> <i class="fa fa-plus-square heeft-stemmen"></i> <i class="fa fa-minus-square heeft-stemmen"></i> </td> <td class="nummer-titel"></td> <td class="nummer-artiest"></td> <td class="text-center aantal-stemmen"></td> </tr> <tr class="collapse" aria-expanded="false"> <td class="hidden-row" colspan="5"> <div class="bs-callout bs-callout-info"> <table class="table"> <thead> <tr> <th>Aangevraagd op</th> <th>Toelichting</th> <th class="text-center">Behandeld</th> </tr> </thead> <tbody></tbody> </table> </div> </td> </tr> ');this.e_tr_uitklap=s.item(0),this.e_tr_gegevens=s.item(1);const i=a.Df(12);this.e_tr_uitklap.setAttribute("data-target",`#${i}`),this.e_tr_gegevens.id=i,this.e_aantal_stemmen=this.e_tr_uitklap.getElementsByClassName("aantal-stemmen").item(0),this.e_container.appendChild(this.e_tr_uitklap),this.e_container.appendChild(this.e_tr_gegevens)}set_nummer(e){let{id:t,titel:s,artiest:a,is_vrijekeuze:i}=e;this.nummer_id=t,this.titel=s,this.artiest=a;for(const e of this.e_tr_uitklap.getElementsByClassName("nummer-titel"))e.appendChild(document.createTextNode(this.titel));for(const e of this.e_tr_uitklap.getElementsByClassName("nummer-artiest"))e.appendChild(document.createTextNode(this.artiest));i&&this.e_tr_uitklap.classList.add("vrijekeuze")}async maak_velden_labels(e){const t=this.e_tr_gegevens.querySelector("thead tr"),s=t.firstChild,a=await e;for(const e of a){const a=document.createElement("th");a.appendChild(document.createTextNode(e)),t.insertBefore(a,s)}}maak_stemmen(e){const t=this.e_tr_gegevens.getElementsByTagName("tbody").item(0);e.length>0&&this.e_tr_uitklap.classList.add("heeft-stemmen");for(const s of e){let e=new d(this,t,s);e.eventer.addEventListener("change_is_behandeld",this.update_behandeld.bind(this)),e.eventer.addEventListener("verwijderd",this.stem_verwijderd_handler.bind(this,e)),this.resultaten_stemmen.push(e)}this.update_aantal_stemmen(),this.update_behandeld()}update_behandeld(e){let t;for(const e of this.resultaten_stemmen)if(t??=e.is_behandeld,t&=e.is_behandeld,!t)break;t?this.e_tr_uitklap.classList.add("success"):this.e_tr_uitklap.classList.remove("success")}stem_verwijderd_handler(e,t){for(const[t,s]of this.resultaten_stemmen.entries())e.stemmer_id===s.stemmer_id&&(this.resultaten_stemmen.splice(t,1),a.hZ(this.eventer,"stem_verwijderd"));this.update_aantal_stemmen(),0===this.resultaten_stemmen.length&&(this.e_tr_gegevens.parentElement.removeChild(this.e_tr_gegevens),this.e_tr_uitklap.parentNode.removeChild(this.e_tr_uitklap))}get_aantal_stemmen(){return this.resultaten_stemmen.length}update_aantal_stemmen(){this.e_aantal_stemmen.innerText=this.get_aantal_stemmen()}filter(e,t,s,a){let i=""==e||this.titel.toLowerCase().includes(e)||this.artiest.toLowerCase().includes(e);if(i){let e=!1;for(const i of this.resultaten_stemmen)e|=i.filter(t,s,a);i&=e}i?this.e_tr_uitklap.classList.remove("verborgen"):(this.inklappen(),this.e_tr_uitklap.classList.add("verborgen"))}inklappen(){i(this.e_tr_gegevens).collapse("hide")}uitklappen(){i(this.e_tr_gegevens).collapse("show")}}class d{resultaten_nummer;eventer;e_tr;e_behandeld_input;is_behandeld;stemmer_id;metadata_voor_filter;timestamp;constructor(e,t,s){let{stemmer_id:i,ip:n,is_behandeld:l,toelichting:r,timestamp:d,velden:m}=s;this.resultaten_nummer=e,this.eventer=document.createElement(null),this.stemmer_id=i,this.metadata_voor_filter=[],this.timestamp=new Date(d),this.is_behandeld=l,this.e_tr=a.am('<tr class="stemmer"> <td class="stemmer-timestamp nobreak"></td> <td class="stem-toelichting"></td> <td class="text-center hand"> <input type="checkbox" class="hand"> </td> <td> <div class="hand stem-verwijderen" title="Stem verwijderen"> <i class="fa fa-times fa-1 text-danger"></i> </div> </td> </tr> ').item(0),this.e_behandeld_input=this.e_tr.getElementsByTagName("input").item(0),this.e_behandeld_input.checked=this.is_behandeld,this.update_behandeld();for(const e of this.e_tr.getElementsByClassName("stemmer-timestamp"))e.appendChild(document.createTextNode(this.timestamp.toLocaleString("nl-NL",{dateStyle:"short",timeStyle:"short"})));for(const e of this.e_tr.getElementsByClassName("stem-toelichting"))e.appendChild(document.createTextNode(r));this.maak_velden(m),this.e_tr.firstChild.setAttribute("title",n),this.e_behandeld_input.addEventListener("change",this.behandeld_handler.bind(this)),this.e_tr.getElementsByClassName("stem-verwijderen").item(0).addEventListener("click",this.verwijderen.bind(this)),t.appendChild(this.e_tr)}maak_velden(e){const t=this.e_tr.firstChild;for(const s of e){this.metadata_voor_filter.push(s.waarde);let e=document.createElement("td");if(null!==s.waarde&&""!==s.waarde){if("email"===s.type||"tel"===s.type){let t,i=document.createElement("a"),n="";"email"===s.type&&(n="mailto:"),"tel"===s.type&&(n="tel:"),i.setAttribute("href",`${n}${s.waarde}`),t="tel"===s.type?a.Jc(s.waarde):s.waarde,i.appendChild(document.createTextNode(t)),e.appendChild(i)}else e.appendChild(document.createTextNode(s.waarde));"email"!==s.type&&"tel"!==s.type&&"postcode"!==s.type||e.classList.add("nobreak")}this.e_tr.insertBefore(e,t)}}async behandeld_handler(e){try{await a.$y(this.resultaten_nummer.nummer_id,this.resultaten_nummer.resultaten_modal.lijst_id,this.stemmer_id,this.e_behandeld_input.checked),this.is_behandeld=this.e_behandeld_input.checked,a.hZ(this.eventer,"change_is_behandeld",this.is_behandeld),this.update_behandeld()}catch(e){this.e_behandeld_input.checked=!this.e_behandeld_input.checked}}update_behandeld(){this.is_behandeld?this.e_tr.classList.add("success"):this.e_tr.classList.remove("success")}async verwijderen(e){await a.z9(this.resultaten_nummer.nummer_id,this.resultaten_nummer.resultaten_modal.lijst_id,this.stemmer_id),this.e_tr.parentNode.removeChild(this.e_tr),a.hZ(this.eventer,"verwijderd")}filter(e,t,s){let a=!1;if(""===e||null===e)a=!0;else for(const t of this.metadata_voor_filter)if("string"==typeof t&&(a|=t.toLowerCase().includes(e)),a)break;const i=a&&(null===t||this.timestamp>=t)&&(null===s||this.timestamp<=s);return i?this.e_tr.classList.remove("verborgen"):this.e_tr.classList.add("verborgen"),i}}class m{lijst_id;eventer;e_modal;$modal;e_form;e_velden_zichtbaar_kolom;e_velden_verplicht_kolom;constructor(e){this.lijst_id=e,this.eventer=document.createElement(null),this.e_modal=a.am('<div class="modal fade lijstinstellingen beheer-modal" id="beheer" role="dialog"> <div class="modal-dialog"> <div class="modal-header modal-top"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> <h4 class="modal-title"> <span class="not-is-nieuw">Beheer van de lijst ‘<span class="lijst-naam"></span>’</span> <span class="is-nieuw">Nieuwe muzieklijst</span> </h4> </div> <div class="modal-content"><div class="container-fluid beheercontainer"> <form class="form-horizontal" role="form" method="post" id="beheer-lijst"> <input type="hidden" name="lijst"> <div class="separator"></div> <div class="form-group"> <label class="control-label col-sm-2" for="naam">Naam lijst:</label> <div class="col-sm-10"> <input type="text" class="form-control" id="naam" name="naam" required> </div> </div> <div class="separator"></div> <div class="form-group"> <label class="control-label col-sm-2" for="email">E-mailadressen voor reacties: <span class="glyphicon glyphicon-info-sign pointer" title="Meerdere e-mailadressen scheiden door een komma ( , )"></span></label> <div class="col-sm-10"> <input type="text" class="form-control" id="email" name="email"> </div> </div> <div class="separator"></div> <div class="form-group"> <label class="control-label col-sm-2" for="bedankt-tekst">Tekst voor bezoekers na het stemmen: <span class="glyphicon glyphicon-info-sign pointer" title="De tekst die de stemmers te zien krijgen nadat ze hun stem hebben ingediend."></span></label> <div class="col-sm-10"> <input type="text" class="form-control" id="bedankt-tekst" name="bedankt-tekst" value="Bedankt voor je keuze." required> </div> </div> <div class="separator"></div> <div class="form-group"> <label class="control-label col-sm-2" for="velden">Velden tonen:</label> <div class="col-sm-2 velden-zichtbaar-kolom"></div> <div class="col-sm-8 velden-verplicht-kolom"></div> </div> <div class="separator"></div> <div class="form-group"> <label class="control-label col-sm-2" for="velden">Opties:</label> <div class="col-sm-10"> Minimum aantal keuzes <input type="number" class="form-control" id="minkeuzes" name="minkeuzes" min="1" required><br> Maximum aantal keuzes <input type="number" class="form-control" id="maxkeuzes" name="maxkeuzes" min="1" required><br> Aantal vrije keuzes <input type="number" class="form-control" id="vrijekeuzes" name="vrijekeuzes" min="0" required><br> Aantal stemmen per IP (leeglaten voor onbeperkt) <input type="number" class="form-control" id="stemmen-per-ip" name="stemmen-per-ip" min="1"><br> <input type="checkbox" id="is-actief" name="is-actief"> Lijst is actief (stemmen staat aan)<br> <input type="checkbox" id="artiest-eenmalig" name="artiest-eenmalig"> Artiesten eenmalig te selecteren <br> <input type="checkbox" id="recaptcha" name="recaptcha"> Re-Captcha<br> <input type="checkbox" id="mail-stemmers" name="mail-stemmers"> Stuur stemmers een e-mail nadat zij hebben gestemd<br> <input type="checkbox" id="random-volgorde" name="random-volgorde"> Toon nummers in willekeurige volgorde<br> </div> </div> <div class="separator"></div> <div class="form-group"> <div class="col-sm-2"></div> <div class="col-sm-10"> <input type="submit" class="btn btn-primary" value="Opslaan"> </div> </div> <div class="form-group beheer-bestaand"> <div class="col-sm-2"></div> <div class="col-sm-10"> <input type="button" name="verwijder-lijst" class="btn btn-danger not-is-nieuw" value="Lijst verwijderen"> </div> </div> <div class="separator beheer-bestaand"></div> </form> </div></div> <div class="modal-footer modal-end"> <button type="button" class="btn btn-default" data-dismiss="modal">Sluiten</button> </div> </div> </div> ').item(0),this.e_form=this.e_modal.getElementsByTagName("form").item(0),this.e_velden_zichtbaar_kolom=this.e_modal.getElementsByClassName("velden-zichtbaar-kolom").item(0),this.e_velden_verplicht_kolom=this.e_modal.getElementsByClassName("velden-verplicht-kolom").item(0),this.is_nieuw()?(this.e_modal.classList.add("is-nieuw"),this.maak_lege_veld_checks()):this.vul_data(),document.getElementsByTagName("body").item(0).appendChild(this.e_modal),this.e_form.addEventListener("submit",this.opslaan.bind(this)),this.e_form.elements["verwijder-lijst"].addEventListener("click",this.verwijder_lijst.bind(this)),this.$modal=i(this.e_modal),this.$modal.modal({backdrop:!0,focus:!0,keyboard:!0}),this.$modal.on("hidden.bs.modal",this.destroy.bind(this)),this.$modal.modal("show")}is_nieuw(){return void 0===this.lijst_id}async vul_data(){this.e_form.elements.lijst.value=this.lijst_id;const e=await a.bE("get_beheer_lijstdata",{lijst:this.lijst_id});for(const t of this.e_modal.querySelectorAll(".lijst-naam"))t.textContent=e.naam;this.e_form.elements["is-actief"].checked=e.is_actief,this.e_form.elements.naam.value=e.naam,this.e_form.elements.minkeuzes.value=e.minkeuzes,this.e_form.elements.maxkeuzes.value=e.maxkeuzes,this.e_form.elements.vrijekeuzes.value=e.vrijekeuzes,this.e_form.elements["stemmen-per-ip"].value=e.stemmen_per_ip,this.e_form.elements["artiest-eenmalig"].checked=e.artiest_eenmalig,this.e_form.elements["mail-stemmers"].checked=e.mail_stemmers,this.e_form.elements["random-volgorde"].checked=e.random_volgorde,this.e_form.elements.recaptcha.checked=e.recaptcha,this.e_form.elements.email.value=e.email,this.e_form.elements["bedankt-tekst"].value=e.bedankt_tekst;for(const t of e.velden)this.maak_veld_checks(t)}async maak_lege_veld_checks(){const e=await a.bE("get_alle_velden");for(const t of e)this.maak_veld_checks(t)}maak_veld_checks(e){const t=a.Df(16),s=a.Df(16);let i=document.createElement("div"),n=document.createElement("label"),l=document.createElement("input"),r=document.createTextNode(e.label),d=document.createElement("div"),m=document.createElement("label"),o=document.createElement("input"),c=document.createTextNode("Verplicht");this.e_velden_zichtbaar_kolom.appendChild(i),i.appendChild(n),n.appendChild(l),n.appendChild(r),this.e_velden_verplicht_kolom.appendChild(d),d.appendChild(m),m.appendChild(o),m.appendChild(c),i.classList.add("checkbox"),d.classList.add("checkbox"),l.type="checkbox",l.id=t,l.name=`velden[${e.id}][tonen]`,l.checked=e.tonen,l.setAttribute("data-input-verplicht",s),l.addEventListener("change",this.check_verplicht.bind(this)),n.for=t,o.type="checkbox",o.id=s,o.name=`velden[${e.id}][verplicht]`,o.checked=e.verplicht,o.disabled=!e.tonen,m.for=s}async opslaan(e){e.preventDefault();let t=new FormData(this.e_form);if(this.is_nieuw())try{const e=await a.YL(t);a.hZ(this.eventer,"lijst_gemaakt",{id:e,naam:t.get("naam")}),this.$modal.modal("hide")}catch(e){alert(e)}else try{await a.yc(t),a.hZ(this.eventer,"lijst_veranderd",{id:this.lijst_id,naam:t.get("naam")}),this.$modal.modal("hide")}catch(e){alert(e)}}async verwijder_lijst(e){if(confirm("Deze lijst verwijderen?\nOok alle stemmen op nummers uit deze lijst worden verwijderd."))try{await a.q6(this.lijst_id),a.hZ(this.eventer,"lijst_verwijderd",{id:this.lijst_id}),this.$modal.modal("hide")}catch(e){alert(e)}}check_verplicht(e){let t=e.target.getAttribute("data-input-verplicht"),s=document.getElementById(t);s instanceof HTMLInputElement&&(e.target.checked?s.disabled=!1:(s.disabled=!0,s.checked=!1))}destroy(){this.e_modal.parentNode.removeChild(this.e_modal)}}i(document).ready((()=>{new n}))},784:function(e,t,s){function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((s,a)=>{let n=new XMLHttpRequest;n.open("POST","ajax.php",!0),n.onload=i.bind(void 0,n,s,a),n.onerror=i.bind(void 0,n,s,a),t instanceof FormData?t.append("functie",e):(n.setRequestHeader("Content-Type","application/json"),t.functie=e,t=JSON.stringify(t)),n.send(t)}))}function i(e,t,s,a){try{let a=JSON.parse(e.response);!1!==a.error?s(a.errordata):t(a.data)}catch(t){s(e.responseText)}}function n(e){return a("verwijder_lijst",{lijst:e})}function l(e){return a("lijst_opslaan",e)}function r(e){return a("lijst_maken",e)}function d(e,t){return a("losse_nummers_toevoegen",{nummers:e,lijsten:t})}function m(){return a("get_lijsten",{})}function o(e,t,s,i){return a("stem_set_behandeld",{nummer:e,lijst:t,stemmer:s,waarde:i})}function c(e,t,s){return a("verwijder_stem",{nummer:e,lijst:t,stemmer:s})}function h(e,t,s){return a("get_totaal_aantal_stemmers",{lijst:e,van:t,tot:s})}function _(e){return a("stem",e)}function u(e){return a("get_geselecteerde_nummers",{lijst:e})}async function p(e,t,s){t(await a("vul_datatables",e))}function v(){return a("login",{})}function f(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children}function b(e,t,s){void 0!==s?e.dispatchEvent(new CustomEvent(t,{detail:s})):e.dispatchEvent(new CustomEvent(t))}function g(e){const t=[/^(\+31)((?:11|16|17|18|22|25|29|31|32|34|41|44|47|47|48|49|51|52|54|56|57|59|67|80|90)[0-9])([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)(6)([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})$/,/^(\+31)([0-9]{2})([0-9]{3})([0-9]{2})([0-9]{2})$/];for(const s of t){let t=e.match(s);if(null!==t&&t.length>0)return t.shift(),t.join(" ")}return e}function j(e){let t="";for(;t.length<e;)t+=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(36);return t.substring(0,e)}s.d(t,{$y:function(){return o},Df:function(){return j},Jc:function(){return g},WS:function(){return _},YL:function(){return r},am:function(){return f},bE:function(){return a},bK:function(){return m},cO:function(){return h},em:function(){return p},hZ:function(){return b},iD:function(){return v},jD:function(){return u},kN:function(){return d},q6:function(){return n},yc:function(){return l},z9:function(){return c}})}},function(e){e.O(0,[778,408],(function(){return t=445,e(e.s=t);var t}));e.O()}]);